<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <style>
        /* Material 3 Design System Variables */
        :root {
            /* Material 3 Color Tokens - Dark Theme */
            --md-sys-color-primary: #BB86FC;
            --md-sys-color-on-primary: #000000;
            --md-sys-color-primary-container: #3700B3;
            --md-sys-color-on-primary-container: #E1C4FF;
            --md-sys-color-secondary: #03DAC6;
            --md-sys-color-on-secondary: #000000;
            --md-sys-color-secondary-container: #018786;
            --md-sys-color-on-secondary-container: #A7F3D0;
            --md-sys-color-tertiary: #CF6679;
            --md-sys-color-on-tertiary: #000000;
            --md-sys-color-error: #CF6679;
            --md-sys-color-on-error: #000000;
            --md-sys-color-error-container: #93000A;
            --md-sys-color-on-error-container: #FFDAD6;
            --md-sys-color-background: #121212;
            --md-sys-color-on-background: #E0E0E0;
            --md-sys-color-surface: #1E1E1E;
            --md-sys-color-on-surface: #E0E0E0;
            --md-sys-color-surface-variant: #2D2D2D;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-outline: #938F99;
            --md-sys-color-outline-variant: #49454F;
            --md-sys-color-shadow: #000000;
            --md-sys-color-scrim: #000000;
            --md-sys-color-inverse-surface: #E6E1E5;
            --md-sys-color-inverse-on-surface: #313033;
            --md-sys-color-inverse-primary: #6750A4;
            --md-sys-color-surface-dim: #141218;
            --md-sys-color-surface-bright: #3B383E;
            --md-sys-color-surface-container-lowest: #0F0D13;
            --md-sys-color-surface-container-low: #1D1B20;
            --md-sys-color-surface-container: #211F26;
            --md-sys-color-surface-container-high: #2B2930;
            --md-sys-color-surface-container-highest: #36343B;

            /* Custom Properties */
            --sidebar-width: 280px;
            --header-height: 64px;
            --fab-size: 56px;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
            overflow-x: hidden;
        }

        /* App Container */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--md-sys-color-surface-container);
            border-right: 1px solid var(--md-sys-color-outline-variant);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            transform: translateX(-100%);
            transition: transform 300ms cubic-bezier(0.2, 0, 0, 1);
            z-index: 100;
            overflow-y: auto;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-title {
            font-size: 22px;
            font-weight: 400;
            color: var(--md-sys-color-on-surface);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-sidebar {
            background: none;
            border: none;
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
            padding: 8px;
            border-radius: 20px;
            transition: background-color 200ms;
        }

        .close-sidebar:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .nav-list {
            list-style: none;
            padding: 12px 0;
        }

        .nav-item {
            margin: 4px 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            text-decoration: none;
            color: var(--md-sys-color-on-surface);
            border-radius: 28px;
            transition: all 200ms;
            position: relative;
            overflow: hidden;
        }

        .nav-link:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .nav-link.active {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 0;
            transition: margin-left 300ms cubic-bezier(0.2, 0, 0, 1);
        }

        /* Header */
        .header {
            height: var(--header-height);
            background-color: var(--md-sys-color-surface);
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            display: flex;
            align-items: center;
            padding: 0 24px;
            gap: 16px;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: var(--md-sys-color-on-surface);
            cursor: pointer;
            padding: 8px;
            border-radius: 20px;
            transition: background-color 200ms;
        }

        .menu-toggle:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .page-title {
            font-size: 24px;
            font-weight: 400;
            color: var(--md-sys-color-on-surface);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Material 3 Buttons */
        .md-filled-button {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            border-radius: 20px;
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms;
            box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .md-filled-button:hover {
            box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .md-outlined-button {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 20px;
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .md-outlined-button:hover {
            background-color: rgba(187, 134, 252, 0.08);
            transform: translateY(-1px);
        }

        .md-text-button {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: none;
            border-radius: 20px;
            padding: 10px 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .md-text-button:hover {
            background-color: rgba(187, 134, 252, 0.08);
        }

        .md-icon-button {
            background-color: transparent;
            color: var(--md-sys-color-on-surface-variant);
            border: none;
            border-radius: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 200ms;
            position: relative;
            overflow: hidden;
        }

        .md-icon-button:hover {
            background-color: rgba(202, 196, 208, 0.08);
            transform: scale(1.1);
        }

        .md-icon-button:active {
            transform: scale(0.95);
        }

        .md-fab {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border: none;
            border-radius: 16px;
            width: var(--fab-size);
            height: var(--fab-size);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
            transition: all 200ms;
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 60;
        }

        .md-fab:hover {
            box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.3), 0px 6px 10px 4px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .md-fab:active {
            transform: scale(0.95);
        }

        /* Content Area */
        .content {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page {
            display: none;
            animation: fadeIn 300ms cubic-bezier(0.2, 0, 0, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Material 3 Cards */
        .md-card {
            background-color: var(--md-sys-color-surface-container);
            border-radius: 12px;
            box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            transition: all 200ms;
            overflow: hidden;
        }

        .md-card:hover {
            box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .md-card-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .md-card-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .md-card-content {
            padding: 24px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border-radius: 16px;
            padding: 24px;
            color: white;
            position: relative;
            overflow: hidden;
            transition: all 300ms cubic-bezier(0.2, 0, 0, 1);
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.3), 0px 8px 12px 6px rgba(0, 0, 0, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-card-icon {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-card-expand-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 200ms;
        }

        .stat-card-expand-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-card-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 16px;
        }

        .stat-card-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 300ms cubic-bezier(0.2, 0, 0, 1);
        }

        .stat-card.expanded .stat-card-details {
            max-height: 200px;
        }

        /* Quick Add Menu */
        .quick-add-menu {
            position: fixed;
            bottom: 90px;
            right: 24px;
            background-color: var(--md-sys-color-surface-container);
            border-radius: 12px;
            box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.3), 0px 6px 10px 4px rgba(0, 0, 0, 0.15);
            padding: 8px;
            transform: scale(0) translateY(20px);
            opacity: 0;
            transition: all 200ms cubic-bezier(0.2, 0, 0, 1);
            z-index: 55;
            min-width: 200px;
        }

        .quick-add-menu.show {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .quick-add-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 200ms;
            color: var(--md-sys-color-on-surface);
            text-decoration: none;
        }

        .quick-add-item:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: var(--header-height);
            right: 0;
            width: 400px;
            max-width: 90vw;
            height: calc(100vh - var(--header-height));
            background-color: var(--md-sys-color-surface-container);
            border-left: 1px solid var(--md-sys-color-outline-variant);
            transform: translateX(100%);
            transition: transform 300ms cubic-bezier(0.2, 0, 0, 1);
            z-index: 90;
            overflow-y: auto;
        }

        .notification-panel.show {
            transform: translateX(0);
        }

        .notification-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }

        .notification-list {
            padding: 16px;
        }

        .notification-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: background-color 200ms;
        }

        .notification-item:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-icon.meeting {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .notification-icon.task {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
        }

        .notification-icon.lead {
            background-color: var(--md-sys-color-tertiary);
            color: var(--md-sys-color-on-tertiary);
        }

        .notification-icon.reminder {
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }

        .notification-content {
            flex: 1;
        }

        .notification-text {
            font-size: 14px;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--md-sys-color-on-surface-variant);
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 300ms cubic-bezier(0.2, 0, 0, 1);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--md-sys-color-surface-container);
            border-radius: 16px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.8) translateY(20px);
            transition: transform 300ms cubic-bezier(0.2, 0, 0, 1);
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
            padding: 8px;
            border-radius: 20px;
            transition: background-color 200ms;
        }

        .modal-close:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .form-section {
            margin-bottom: 24px;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .md-text-field {
            position: relative;
            margin-bottom: 16px;
        }

        .md-text-field input,
        .md-text-field textarea {
            width: 100%;
            padding: 16px 12px 8px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 4px;
            background-color: transparent;
            color: var(--md-sys-color-on-surface);
            font-size: 16px;
            transition: all 200ms;
        }

        .md-text-field input:focus,
        .md-text-field textarea:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            border-width: 2px;
        }

        .md-text-field label {
            position: absolute;
            left: 12px;
            top: 16px;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 16px;
            transition: all 200ms;
            pointer-events: none;
            background-color: var(--md-sys-color-surface-container);
            padding: 0 4px;
        }

        .md-text-field input:focus + label,
        .md-text-field input:not(:placeholder-shown) + label,
        .md-text-field textarea:focus + label,
        .md-text-field textarea:not(:placeholder-shown) + label {
            top: -8px;
            font-size: 12px;
            color: var(--md-sys-color-primary);
        }

        /* Custom Dropdown */
        .custom-dropdown {
            position: relative;
            margin-bottom: 16px;
        }

        .custom-dropdown-button {
            width: 100%;
            padding: 16px 12px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 4px;
            background-color: transparent;
            color: var(--md-sys-color-on-surface);
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 200ms;
        }

        .custom-dropdown-button:hover {
            border-color: var(--md-sys-color-primary);
        }

        .custom-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--md-sys-color-surface-container);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 4px;
            box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.3), 0px 6px 10px 4px rgba(0, 0, 0, 0.15);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 200ms;
        }

        .custom-dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .custom-dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 200ms;
            color: var(--md-sys-color-on-surface);
        }

        .custom-dropdown-item:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .custom-dropdown-item.add-custom {
            border-top: 1px solid var(--md-sys-color-outline-variant);
            color: var(--md-sys-color-primary);
            font-weight: 500;
        }

        /* Priority Badges */
        .priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .priority-badge.low {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .priority-badge.medium {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        .priority-badge.high {
            background-color: rgba(255, 87, 34, 0.2);
            color: #FF5722;
        }

        .priority-badge.urgent {
            background-color: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        /* Snackbar */
        .snackbar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.3), 0px 6px 10px 4px rgba(0, 0, 0, 0.15);
            z-index: 300;
            transition: transform 300ms cubic-bezier(0.2, 0, 0, 1);
            max-width: 400px;
        }

        .snackbar.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Filter Buttons */
        .task-filter, .reminder-filter, .transaction-filter {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            transition: all 200ms;
        }

        .task-filter.active, .reminder-filter.active, .transaction-filter.active {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border-color: var(--md-sys-color-primary);
        }

        /* Task Item Styles */
        .task-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--md-sys-color-surface-variant);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 200ms;
        }

        .task-item:hover {
            background: var(--md-sys-color-surface-container-high);
        }

        .task-item.completed {
            opacity: 0.7;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 16px;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .task-meta {
            font-size: 12px;
            color: var(--md-sys-color-on-surface-variant);
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        /* Reminder Item Styles */
        .reminder-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--md-sys-color-surface-variant);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 200ms;
        }

        .reminder-item:hover {
            background: var(--md-sys-color-surface-container-high);
        }

        .reminder-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .reminder-content {
            flex: 1;
        }

        .reminder-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .reminder-meta {
            font-size: 12px;
            color: var(--md-sys-color-on-surface-variant);
            display: flex;
            gap: 16px;
            align-items: center;
        }

        /* Transaction Item Styles */
        .transaction-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--md-sys-color-surface-variant);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 200ms;
        }

        .transaction-item:hover {
            background: var(--md-sys-color-surface-container-high);
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
        }

        .transaction-icon.income {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .transaction-icon.expense {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        .transaction-content {
            flex: 1;
        }

        .transaction-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .transaction-meta {
            font-size: 12px;
            color: var(--md-sys-color-on-surface-variant);
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .transaction-amount {
            font-size: 18px;
            font-weight: 700;
        }

        .transaction-amount.income {
            color: #4CAF50;
        }

        .transaction-amount.expense {
            color: #F44336;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-badge.pending {
            background-color: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }

        .status-badge.completed {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .status-badge.failed {
            background-color: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }

        /* Utility Classes */
        .flex {
            display: flex;
        }

        .gap-8 {
            gap: 8px;
        }

        .gap-12 {
            gap: 12px;
        }

        .gap-16 {
            gap: 16px;
        }

        .mb-16 {
            margin-bottom: 16px;
        }

        .mb-24 {
            margin-bottom: 24px;
        }

        .mt-24 {
            margin-top: 24px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
            }

            .content {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .notification-panel {
                width: 100%;
            }

            .modal-content {
                width: 95%;
                padding: 16px;
            }
        }

        /* 1080x720 Optimization */
        @media (width: 1080px) and (height: 720px) {
            .content {
                padding: 16px;
                max-width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-card-value {
                font-size: 24px;
            }

            .md-card-content {
                padding: 16px;
            }

            .sidebar {
                width: 240px;
            }

            .main-content.sidebar-open {
                margin-left: 240px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <span class="material-symbols-outlined">business</span>
                    Business Manager
                </div>
                <button class="close-sidebar" id="closeSidebar">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <span class="material-symbols-outlined">dashboard</span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="leads">
                        <span class="material-symbols-outlined">people</span>
                        Lead Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="projects">
                        <span class="material-symbols-outlined">folder</span>
                        Project Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="finance">
                        <span class="material-symbols-outlined">account_balance</span>
                        Finance
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="tasks">
                        <span class="material-symbols-outlined">task</span>
                        Today's Work
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="analytics">
                        <span class="material-symbols-outlined">analytics</span>
                        Analytics
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="reminders">
                        <span class="material-symbols-outlined">notifications</span>
                        Reminders
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="settings">
                        <span class="material-symbols-outlined">settings</span>
                        Settings
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header">
                <button class="menu-toggle" id="menuToggle">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <div class="page-title" id="pageTitle">
                    <span class="material-symbols-outlined">dashboard</span>
                    Dashboard
                </div>
                <div class="header-actions">
                    <button class="md-icon-button" id="notificationBtn">
                        <span class="material-symbols-outlined">notifications</span>
                    </button>
                    <button class="md-icon-button" id="profileBtn">
                        <span class="material-symbols-outlined">account_circle</span>
                    </button>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Page -->
                <div class="page active" id="dashboard">
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card" onclick="toggleStatCard(this)">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <span class="material-symbols-outlined">people</span>
                                </div>
                                <button class="stat-card-expand-btn">
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                            </div>
                            <div class="stat-card-value" id="totalLeads">0</div>
                            <div class="stat-card-label">Total Leads</div>
                            <div class="stat-card-details">
                                <div style="font-size: 14px; opacity: 0.9;">
                                    <div style="margin-bottom: 8px;">• New leads: <span id="newLeads">0</span></div>
                                    <div style="margin-bottom: 8px;">• Conversion rate: <span id="conversionRate">0%</span></div>
                                    <div style="margin-bottom: 8px;">• Average deal size: ₹<span id="avgDealSize">0</span></div>
                                    <div>• This month: <span id="monthlyGrowth">0%</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="toggleStatCard(this)">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <span class="material-symbols-outlined">folder</span>
                                </div>
                                <button class="stat-card-expand-btn">
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                            </div>
                            <div class="stat-card-value" id="activeProjects">0</div>
                            <div class="stat-card-label">Active Projects</div>
                            <div class="stat-card-details">
                                <div style="font-size: 14px; opacity: 0.9;">
                                    <div style="margin-bottom: 8px;">• Completed: <span id="completedProjects">0</span></div>
                                    <div style="margin-bottom: 8px;">• In progress: <span id="inProgressProjects">0</span></div>
                                    <div style="margin-bottom: 8px;">• Avg completion: <span id="avgCompletion">0</span> days</div>
                                    <div>• Success rate: <span id="successRate">0%</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="toggleStatCard(this)">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <span class="material-symbols-outlined">currency_rupee</span>
                                </div>
                                <button class="stat-card-expand-btn">
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                            </div>
                            <div class="stat-card-value" id="totalRevenue">₹0</div>
                            <div class="stat-card-label">Total Revenue</div>
                            <div class="stat-card-details">
                                <div style="font-size: 14px; opacity: 0.9;">
                                    <div style="margin-bottom: 8px;">• This month: ₹<span id="monthlyRevenue">0</span></div>
                                    <div style="margin-bottom: 8px;">• Expenses: ₹<span id="totalExpenses">0</span></div>
                                    <div style="margin-bottom: 8px;">• Net profit: ₹<span id="netProfit">0</span></div>
                                    <div>• Growth: <span id="revenueGrowth">0%</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="toggleStatCard(this)">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <span class="material-symbols-outlined">task</span>
                                </div>
                                <button class="stat-card-expand-btn">
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                            </div>
                            <div class="stat-card-value" id="pendingTasks">0</div>
                            <div class="stat-card-label">Pending Tasks</div>
                            <div class="stat-card-details">
                                <div style="font-size: 14px; opacity: 0.9;">
                                    <div style="margin-bottom: 8px;">• Due today: <span id="dueToday">0</span></div>
                                    <div style="margin-bottom: 8px;">• Due this week: <span id="dueThisWeek">0</span></div>
                                    <div style="margin-bottom: 8px;">• Overdue: <span id="overdue">0</span></div>
                                    <div>• Completed this week: <span id="completedThisWeek">0</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Projects -->
                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">folder</span>
                                Recent Projects
                            </h3>
                        </div>
                        <div class="md-card-content">
                            <div id="recentProjectsTable">
                                <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    No projects yet. Create your first project to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lead Management Page -->
                <div class="page" id="leads">
                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">people</span>
                                Lead Management
                            </h3>
                            <button class="md-filled-button" id="addLeadBtn">
                                <span class="material-symbols-outlined">add</span>
                                Add Lead
                            </button>
                        </div>
                        <div class="md-card-content">
                            <div id="leadsContainer">
                                <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    No leads yet. Add your first lead to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Management Page -->
                <div class="page" id="projects">
                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">folder</span>
                                Project Management
                            </h3>
                            <button class="md-filled-button" id="addProjectBtn">
                                <span class="material-symbols-outlined">add</span>
                                Add Project
                            </button>
                        </div>
                        <div class="md-card-content">
                            <div id="projectsContainer">
                                <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    No projects yet. Create your first project to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Finance Page -->
                <div class="page" id="finance">
                    <!-- Financial Summary Cards -->
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">trending_up</span>
                            </div>
                            <div class="stat-card-value" id="totalIncomeValue">₹0</div>
                            <div class="stat-card-label">Total Income</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">trending_down</span>
                            </div>
                            <div class="stat-card-value" id="totalExpenseValue">₹0</div>
                            <div class="stat-card-label">Total Expenses</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">account_balance_wallet</span>
                            </div>
                            <div class="stat-card-value" id="netProfitValue">₹0</div>
                            <div class="stat-card-label">Net Profit</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">payments</span>
                            </div>
                            <div class="stat-card-value" id="pendingPaymentsValue">₹0</div>
                            <div class="stat-card-label">Pending Payments</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="md-card" style="margin-bottom: 24px;">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">flash_on</span>
                                Quick Actions
                            </h3>
                        </div>
                        <div class="md-card-content">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <button class="md-filled-button" id="addIncomeBtn">
                                    <span class="material-symbols-outlined">add_circle</span>
                                    Add Income
                                </button>
                                <button class="md-outlined-button" id="addExpenseBtn">
                                    <span class="material-symbols-outlined">remove_circle</span>
                                    Add Expense
                                </button>
                                <button class="md-outlined-button" id="addPaymentReminderBtn">
                                    <span class="material-symbols-outlined">schedule</span>
                                    Payment Reminder
                                </button>
                                <button class="md-outlined-button" id="generateReportBtn">
                                    <span class="material-symbols-outlined">assessment</span>
                                    Generate Report
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">account_balance</span>
                                Finance Management
                            </h3>
                            <button class="md-filled-button" id="addTransactionBtn">
                                <span class="material-symbols-outlined">add</span>
                                Add Transaction
                            </button>
                        </div>
                        <div class="md-card-content">
                            <!-- Transaction Filters -->
                            <div class="transaction-filters" style="margin-bottom: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="md-outlined-button transaction-filter active" data-filter="all">All Transactions</button>
                                <button class="md-outlined-button transaction-filter" data-filter="income">Income</button>
                                <button class="md-outlined-button transaction-filter" data-filter="expense">Expenses</button>
                                <button class="md-outlined-button transaction-filter" data-filter="pending">Pending</button>
                                <button class="md-outlined-button transaction-filter" data-filter="thisMonth">This Month</button>
                            </div>
                            
                            <div id="financeContainer">
                                <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    No transactions yet. Add your first transaction to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Today's Work Page -->
                <div class="page" id="tasks">
                    <!-- Task Summary Cards -->
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">pending_actions</span>
                            </div>
                            <div class="stat-card-value" id="pendingTasksCount">0</div>
                            <div class="stat-card-label">Pending Tasks</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">task_alt</span>
                            </div>
                            <div class="stat-card-value" id="completedTasksCount">0</div>
                            <div class="stat-card-label">Completed Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">schedule</span>
                            </div>
                            <div class="stat-card-value" id="dueTodayCount">0</div>
                            <div class="stat-card-label">Due Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">priority_high</span>
                            </div>
                            <div class="stat-card-value" id="highPriorityCount">0</div>
                            <div class="stat-card-label">High Priority</div>
                        </div>
                    </div>

                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">task</span>
                                Today's Work
                            </h3>
                            <button class="md-filled-button" id="addTaskBtn">
                                <span class="material-symbols-outlined">add</span>
                                Add Task
                            </button>
                        </div>
                        <div class="md-card-content">
                            <!-- Task Filters -->
                            <div class="task-filters" style="margin-bottom: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="md-outlined-button task-filter active" data-filter="all">All Tasks</button>
                                <button class="md-outlined-button task-filter" data-filter="pending">Pending</button>
                                <button class="md-outlined-button task-filter" data-filter="completed">Completed</button>
                                <button class="md-outlined-button task-filter" data-filter="overdue">Overdue</button>
                                <button class="md-outlined-button task-filter" data-filter="high">High Priority</button>
                            </div>
                            
                            <div id="tasksContainer">
                                <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    No tasks yet. Add your first task to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div class="page" id="analytics">
                    <!-- Analytics Summary Cards -->
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">trending_up</span>
                            </div>
                            <div class="stat-card-value" id="monthlyGrowthRate">0%</div>
                            <div class="stat-card-label">Monthly Growth</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">conversion_path</span>
                            </div>
                            <div class="stat-card-value" id="leadConversionRate">0%</div>
                            <div class="stat-card-label">Lead Conversion</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">schedule</span>
                            </div>
                            <div class="stat-card-value" id="avgProjectDuration">0</div>
                            <div class="stat-card-label">Avg Project Days</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">productivity</span>
                            </div>
                            <div class="stat-card-value" id="productivityScore">0%</div>
                            <div class="stat-card-label">Productivity</div>
                        </div>
                    </div>

                    <!-- Charts and Analytics -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 24px;">
                        <!-- Revenue Chart -->
                        <div class="md-card">
                            <div class="md-card-header">
                                <h3 class="md-card-title">
                                    <span class="material-symbols-outlined">bar_chart</span>
                                    Revenue Trend
                                </h3>
                            </div>
                            <div class="md-card-content">
                                <div id="revenueChart" style="height: 200px; display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant);">
                                    Revenue chart will appear here
                                </div>
                            </div>
                        </div>

                        <!-- Lead Sources -->
                        <div class="md-card">
                            <div class="md-card-header">
                                <h3 class="md-card-title">
                                    <span class="material-symbols-outlined">pie_chart</span>
                                    Lead Sources
                                </h3>
                            </div>
                            <div class="md-card-content">
                                <div id="leadSourcesChart" style="height: 200px; display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant);">
                                    Lead sources chart will appear here
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="md-card" style="margin-bottom: 24px;">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">speed</span>
                                Performance Metrics
                            </h3>
                        </div>
                        <div class="md-card-content">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                                <div style="padding: 16px; background: var(--md-sys-color-surface-variant); border-radius: 12px;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                        <span class="material-symbols-outlined">task_alt</span>
                                        <span style="font-weight: 500;">Task Completion Rate</span>
                                    </div>
                                    <div style="font-size: 24px; font-weight: 700; color: var(--md-sys-color-primary);" id="taskCompletionRate">0%</div>
                                </div>
                                <div style="padding: 16px; background: var(--md-sys-color-surface-variant); border-radius: 12px;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                        <span class="material-symbols-outlined">schedule</span>
                                        <span style="font-weight: 500;">On-Time Delivery</span>
                                    </div>
                                    <div style="font-size: 24px; font-weight: 700; color: var(--md-sys-color-secondary);" id="onTimeDeliveryRate">0%</div>
                                </div>
                                <div style="padding: 16px; background: var(--md-sys-color-surface-variant); border-radius: 12px;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                        <span class="material-symbols-outlined">person_check</span>
                                        <span style="font-weight: 500;">Client Satisfaction</span>
                                    </div>
                                    <div style="font-size: 24px; font-weight: 700; color: var(--md-sys-color-tertiary);" id="clientSatisfactionRate">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">analytics</span>
                                Analytics Dashboard
                            </h3>
                            <button class="md-outlined-button" id="refreshAnalyticsBtn">
                                <span class="material-symbols-outlined">refresh</span>
                                Refresh Data
                            </button>
                        </div>
                        <div class="md-card-content">
                            <div id="analyticsContainer">
                                <div style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    <span class="material-symbols-outlined" style="font-size: 48px; margin-bottom: 16px; display: block;">insights</span>
                                    Analytics data will be calculated and displayed here based on your business activities.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reminders Page -->
                <div class="page" id="reminders">
                    <!-- Reminder Summary Cards -->
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">schedule</span>
                            </div>
                            <div class="stat-card-value" id="upcomingRemindersCount">0</div>
                            <div class="stat-card-label">Upcoming</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">today</span>
                            </div>
                            <div class="stat-card-value" id="todayRemindersCount">0</div>
                            <div class="stat-card-label">Due Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">event_repeat</span>
                            </div>
                            <div class="stat-card-value" id="recurringRemindersCount">0</div>
                            <div class="stat-card-label">Recurring</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-icon">
                                <span class="material-symbols-outlined">notification_important</span>
                            </div>
                            <div class="stat-card-value" id="activeRemindersCount">0</div>
                            <div class="stat-card-label">Active</div>
                        </div>
                    </div>

                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">notifications</span>
                                Reminders
                            </h3>
                            <button class="md-filled-button" id="addReminderBtn">
                                <span class="material-symbols-outlined">add</span>
                                Add Reminder
                            </button>
                        </div>
                        <div class="md-card-content">
                            <!-- Reminder Filters -->
                            <div class="reminder-filters" style="margin-bottom: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="md-outlined-button reminder-filter active" data-filter="all">All Reminders</button>
                                <button class="md-outlined-button reminder-filter" data-filter="today">Today</button>
                                <button class="md-outlined-button reminder-filter" data-filter="upcoming">Upcoming</button>
                                <button class="md-outlined-button reminder-filter" data-filter="recurring">Recurring</button>
                                <button class="md-outlined-button reminder-filter" data-filter="completed">Completed</button>
                            </div>
                            
                            <div id="remindersContainer">
                                <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                                    No reminders yet. Add your first reminder to get started!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page" id="settings">
                    <div class="md-card">
                        <div class="md-card-header">
                            <h3 class="md-card-title">
                                <span class="material-symbols-outlined">settings</span>
                                Settings
                            </h3>
                        </div>
                        <div class="md-card-content">
                            <div id="settingsContainer">
                                <div class="form-section">
                                    <div class="form-section-title">
                                        <span class="material-symbols-outlined">palette</span>
                                        Theme Settings
                                    </div>
                                    <div class="form-grid">
                                        <div class="custom-dropdown">
                                            <button class="custom-dropdown-button" data-field="theme">
                                                <span>Dark Theme</span>
                                                <span class="material-symbols-outlined">expand_more</span>
                                            </button>
                                            <div class="custom-dropdown-menu">
                                                <div class="custom-dropdown-item" data-value="dark">Dark Theme</div>
                                                <div class="custom-dropdown-item" data-value="light">Light Theme</div>
                                                <div class="custom-dropdown-item" data-value="auto">Auto</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">
                                        <span class="material-symbols-outlined">person</span>
                                        Profile Settings
                                    </div>
                                    <div class="form-grid">
                                        <div class="md-text-field">
                                            <input type="text" placeholder=" " id="profileName" value="Business Manager">
                                            <label>Full Name</label>
                                        </div>
                                        <div class="md-text-field">
                                            <input type="email" placeholder=" " id="profileEmail" value="manager@business.com">
                                            <label>Email</label>
                                        </div>
                                        <div class="md-text-field">
                                            <input type="text" placeholder=" " id="profileCompany" value="My Business">
                                            <label>Company</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-section-title">
                                        <span class="material-symbols-outlined">notifications</span>
                                        Notification Settings
                                    </div>
                                    <div class="form-grid">
                                        <label style="display: flex; align-items: center; gap: 12px;">
                                            <input type="checkbox" checked id="emailNotifications">
                                            Email Notifications
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 12px;">
                                            <input type="checkbox" checked id="pushNotifications">
                                            Push Notifications
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 12px;">
                                            <input type="checkbox" checked id="meetingReminders">
                                            Meeting Reminders
                                        </label>
                                    </div>
                                </div>

                                <div class="mt-24">
                                    <button class="md-filled-button" id="saveSettingsBtn">
                                        <span class="material-symbols-outlined">save</span>
                                        Save Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="md-fab" id="fab">
            <span class="material-symbols-outlined">add</span>
        </button>

        <!-- Quick Add Menu -->
        <div class="quick-add-menu" id="quickAddMenu">
            <div class="quick-add-item" data-action="lead">
                <span class="material-symbols-outlined">person_add</span>
                Add Lead
            </div>
            <div class="quick-add-item" data-action="project">
                <span class="material-symbols-outlined">create_new_folder</span>
                Add Project
            </div>
            <div class="quick-add-item" data-action="task">
                <span class="material-symbols-outlined">add_task</span>
                Add Task
            </div>
            <div class="quick-add-item" data-action="reminder">
                <span class="material-symbols-outlined">alarm_add</span>
                Add Reminder
            </div>
            <div class="quick-add-item" data-action="transaction">
                <span class="material-symbols-outlined">payments</span>
                Add Transaction
            </div>
        </div>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <div class="notification-title">Notifications & Reminders</div>
                <button class="md-icon-button" id="clearNotifications">
                    <span class="material-symbols-outlined">clear_all</span>
                </button>
            </div>
            <div class="notification-list" id="notificationList">
                <div style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                    No notifications yet. Reminders and activities will appear here.
                </div>
            </div>
        </div>

        <!-- Add Lead Modal -->
        <div class="modal" id="addLeadModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Add New Lead</div>
                    <button class="modal-close" id="cancelAddLead">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <form id="addLeadForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">business</span>
                            Company Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="companyName" required>
                                <label>Company Name</label>
                            </div>
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="contactPerson" required>
                                <label>Contact Person</label>
                            </div>
                            <div class="md-text-field">
                                <input type="email" placeholder=" " id="email" required>
                                <label>Email</label>
                            </div>
                            <div class="md-text-field">
                                <input type="tel" placeholder=" " id="phone" required>
                                <label>Phone Number</label>
                            </div>
                            <div class="md-text-field">
                                <input type="url" placeholder=" " id="website">
                                <label>Website (Optional)</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">category</span>
                            Lead Details
                        </div>
                        <div class="form-grid">
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="category">
                                    <span>Select Category</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="B2B">B2B</div>
                                    <div class="custom-dropdown-item" data-value="B2C">B2C</div>
                                    <div class="custom-dropdown-item" data-value="Enterprise">Enterprise</div>
                                    <div class="custom-dropdown-item" data-value="Startup">Startup</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>

                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="stage">
                                    <span>Select Stage</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="New Lead">New Lead</div>
                                    <div class="custom-dropdown-item" data-value="Contacted">Contacted</div>
                                    <div class="custom-dropdown-item" data-value="Qualified">Qualified</div>
                                    <div class="custom-dropdown-item" data-value="Proposal Sent">Proposal Sent</div>
                                    <div class="custom-dropdown-item" data-value="Negotiating">Negotiating</div>
                                    <div class="custom-dropdown-item" data-value="Converted">Converted</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>

                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="priority">
                                    <span>Select Priority</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Low">Low</div>
                                    <div class="custom-dropdown-item" data-value="Medium">Medium</div>
                                    <div class="custom-dropdown-item" data-value="High">High</div>
                                    <div class="custom-dropdown-item" data-value="Urgent">Urgent</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>

                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="leadOwner">
                                <label>Lead Owner</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">currency_rupee</span>
                            Deal Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="number" placeholder=" " id="dealAmount" min="0" step="0.01">
                                <label>Deal Amount</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="currency">
                                    <span>INR</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="INR">INR</div>
                                    <div class="custom-dropdown-item" data-value="USD">USD</div>
                                    <div class="custom-dropdown-item" data-value="EUR">EUR</div>
                                    <div class="custom-dropdown-item" data-value="GBP">GBP</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">event</span>
                            Meeting & Reminder Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="datetime-local" placeholder=" " id="meetingDateTime">
                                <label>Meeting Date & Time</label>
                            </div>
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="meetingTopic">
                                <label>Meeting Topic</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="meetingType">
                                    <span>Select Meeting Type</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Phone Call">Phone Call</div>
                                    <div class="custom-dropdown-item" data-value="Video Call">Video Call</div>
                                    <div class="custom-dropdown-item" data-value="In-Person">In-Person</div>
                                    <div class="custom-dropdown-item" data-value="Email">Email</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="reminderTime">
                                    <span>Reminder Time</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="5">5 minutes before</div>
                                    <div class="custom-dropdown-item" data-value="15">15 minutes before</div>
                                    <div class="custom-dropdown-item" data-value="30">30 minutes before</div>
                                    <div class="custom-dropdown-item" data-value="60">1 hour before</div>
                                    <div class="custom-dropdown-item" data-value="1440">1 day before</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">note</span>
                            Additional Information
                        </div>
                        <div class="md-text-field">
                            <textarea placeholder=" " id="notes" rows="3"></textarea>
                            <label>Notes</label>
                        </div>
                    </div>

                    <div class="flex gap-16 mt-24">
                        <button type="button" class="md-outlined-button" id="cancelAddLead2">Cancel</button>
                        <button type="submit" class="md-filled-button">
                            <span class="material-symbols-outlined">save</span>
                            Save Lead
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Project Modal -->
        <div class="modal" id="addProjectModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Add New Project</div>
                    <button class="modal-close" id="cancelAddProject">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <form id="addProjectForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">folder</span>
                            Project Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="projectName" required>
                                <label>Project Name</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="projectLead">
                                    <span>Select Lead (Optional)</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu" id="projectLeadDropdown">
                                    <div class="custom-dropdown-item" data-value="">No Lead Selected</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-16 mt-24">
                        <button type="button" class="md-outlined-button" id="cancelAddProject2">Cancel</button>
                        <button type="submit" class="md-filled-button">
                            <span class="material-symbols-outlined">save</span>
                            Save Project
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div class="modal" id="addTaskModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Add New Task</div>
                    <button class="modal-close" id="cancelAddTask">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <form id="addTaskForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">task</span>
                            Task Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="taskTitle" required>
                                <label>Task Title</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="taskPriority">
                                    <span>Select Priority</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Low">Low</div>
                                    <div class="custom-dropdown-item" data-value="Medium">Medium</div>
                                    <div class="custom-dropdown-item" data-value="High">High</div>
                                    <div class="custom-dropdown-item" data-value="Urgent">Urgent</div>
                                </div>
                            </div>
                            <div class="md-text-field">
                                <input type="datetime-local" placeholder=" " id="taskDueDate" required>
                                <label>Due Date & Time</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="taskCategory">
                                    <span>Select Category</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Work">Work</div>
                                    <div class="custom-dropdown-item" data-value="Personal">Personal</div>
                                    <div class="custom-dropdown-item" data-value="Meeting">Meeting</div>
                                    <div class="custom-dropdown-item" data-value="Follow-up">Follow-up</div>
                                    <div class="custom-dropdown-item" data-value="Research">Research</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">description</span>
                            Task Details
                        </div>
                        <div class="md-text-field">
                            <textarea placeholder=" " id="taskDescription" rows="3"></textarea>
                            <label>Task Description</label>
                        </div>
                    </div>
                    <div class="flex gap-16 mt-24">
                        <button type="button" class="md-outlined-button" id="cancelAddTask2">Cancel</button>
                        <button type="submit" class="md-filled-button">
                            <span class="material-symbols-outlined">save</span>
                            Save Task
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Reminder Modal -->
        <div class="modal" id="addReminderModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Add New Reminder</div>
                    <button class="modal-close" id="cancelAddReminder">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <form id="addReminderForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">notifications</span>
                            Reminder Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="reminderTitle" required>
                                <label>Reminder Title</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="reminderType">
                                    <span>Select Type</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Meeting">Meeting</div>
                                    <div class="custom-dropdown-item" data-value="Payment">Payment Due</div>
                                    <div class="custom-dropdown-item" data-value="Follow-up">Follow-up</div>
                                    <div class="custom-dropdown-item" data-value="Deadline">Deadline</div>
                                    <div class="custom-dropdown-item" data-value="Personal">Personal</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>
                            <div class="md-text-field">
                                <input type="datetime-local" placeholder=" " id="reminderDateTime" required>
                                <label>Reminder Date & Time</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="reminderRepeat">
                                    <span>Repeat</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="None">No Repeat</div>
                                    <div class="custom-dropdown-item" data-value="Daily">Daily</div>
                                    <div class="custom-dropdown-item" data-value="Weekly">Weekly</div>
                                    <div class="custom-dropdown-item" data-value="Monthly">Monthly</div>
                                    <div class="custom-dropdown-item" data-value="Yearly">Yearly</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">description</span>
                            Additional Details
                        </div>
                        <div class="md-text-field">
                            <textarea placeholder=" " id="reminderNotes" rows="3"></textarea>
                            <label>Notes (Optional)</label>
                        </div>
                    </div>
                    <div class="flex gap-16 mt-24">
                        <button type="button" class="md-outlined-button" id="cancelAddReminder2">Cancel</button>
                        <button type="submit" class="md-filled-button">
                            <span class="material-symbols-outlined">save</span>
                            Save Reminder
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Transaction Modal -->
        <div class="modal" id="addTransactionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Add New Transaction</div>
                    <button class="modal-close" id="cancelAddTransaction">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <form id="addTransactionForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">payments</span>
                            Transaction Information
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="transactionTitle" required>
                                <label>Transaction Title</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="transactionType">
                                    <span>Select Type</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Income">Income</div>
                                    <div class="custom-dropdown-item" data-value="Expense">Expense</div>
                                </div>
                            </div>
                            <div class="md-text-field">
                                <input type="number" placeholder=" " id="transactionAmount" required min="0" step="0.01">
                                <label>Amount</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="transactionCategory">
                                    <span>Select Category</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Client Payment">Client Payment</div>
                                    <div class="custom-dropdown-item" data-value="Project Revenue">Project Revenue</div>
                                    <div class="custom-dropdown-item" data-value="Office Rent">Office Rent</div>
                                    <div class="custom-dropdown-item" data-value="Utilities">Utilities</div>
                                    <div class="custom-dropdown-item" data-value="Marketing">Marketing</div>
                                    <div class="custom-dropdown-item" data-value="Equipment">Equipment</div>
                                    <div class="custom-dropdown-item" data-value="Travel">Travel</div>
                                    <div class="custom-dropdown-item" data-value="Software">Software</div>
                                    <div class="custom-dropdown-item add-custom">+ Add Custom</div>
                                </div>
                            </div>
                            <div class="md-text-field">
                                <input type="date" placeholder=" " id="transactionDate" required>
                                <label>Transaction Date</label>
                            </div>
                            <div class="custom-dropdown">
                                <button type="button" class="custom-dropdown-button" data-field="transactionStatus">
                                    <span>Status</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </button>
                                <div class="custom-dropdown-menu">
                                    <div class="custom-dropdown-item" data-value="Completed">Completed</div>
                                    <div class="custom-dropdown-item" data-value="Pending">Pending</div>
                                    <div class="custom-dropdown-item" data-value="Failed">Failed</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title">
                            <span class="material-symbols-outlined">description</span>
                            Additional Details
                        </div>
                        <div class="form-grid">
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="transactionReference">
                                <label>Reference/Invoice Number (Optional)</label>
                            </div>
                            <div class="md-text-field">
                                <input type="text" placeholder=" " id="transactionClient">
                                <label>Client/Vendor Name (Optional)</label>
                            </div>
                        </div>
                        <div class="md-text-field">
                            <textarea placeholder=" " id="transactionNotes" rows="3"></textarea>
                            <label>Notes (Optional)</label>
                        </div>
                    </div>
                    <div class="flex gap-16 mt-24">
                        <button type="button" class="md-outlined-button" id="cancelAddTransaction2">Cancel</button>
                        <button type="submit" class="md-filled-button">
                            <span class="material-symbols-outlined">save</span>
                            Save Transaction
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Snackbar -->
        <div class="snackbar" id="snackbar"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, update, remove, push, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC_X2q8m22D_ujnHGS9sbtf5BbBaR6Uc2M",
            authDomain: "lead-manage-maan.firebaseapp.com",
            databaseURL: "https://lead-manage-maan-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lead-manage-maan",
            storageBucket: "lead-manage-maan.firebasestorage.app",
            messagingSenderId: "929826628899",
            appId: "1:929826628899:web:30811e98a4ae13bb4fd896",
            measurementId: "G-T38XMZEBNS"
        };

        // Global Firebase variables
        let app, database;

        // Initialize Firebase function
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                database = getDatabase(app);
                console.log('🔥 Firebase connected successfully!');
                return database;
            } catch (error) {
                console.error('❌ Firebase initialization error:', error);
                throw error;
            }
        }

        // Make Firebase and functions available globally
        function makeGloballyAvailable() {
            window.database = database;
            window.ref = ref;
            window.set = set;
            window.get = get;
            window.update = update;
            window.remove = remove;
            window.push = push;
            window.onValue = onValue;
            
            // Make functions globally available
            window.toggleTaskStatus = toggleTaskStatus;
            window.deleteTask = deleteTask;
            window.editTask = (id) => console.log('Edit task:', id);
            window.markReminderComplete = markReminderComplete;
            window.deleteReminder = deleteReminder;
            window.editReminder = (id) => console.log('Edit reminder:', id);
            window.deleteTransaction = deleteTransaction;
            window.editTransaction = (id) => console.log('Edit transaction:', id);
            window.enhancedHandleQuickAdd = enhancedHandleQuickAdd;
        }

        // Global variables for DOM elements (will be initialized after DOM loads)
        let sidebar, menuToggle, fab, quickAddMenu, notificationBtn, notificationPanel, addLeadModal, addProjectModal;

                // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('🚀 Initializing Business Manager...');
                
                // Initialize DOM elements first
                initializeDOMElements();
                
                // Initialize Firebase
                await initializeFirebase();
                console.log('✅ Firebase initialized');
                
                // Setup all event listeners
                setupEventListeners();
                setupNotifications();
                
                // Load all data
                await loadDashboard();
                await loadLeads();
                await loadProjects();
                await loadTasks();
                await loadReminders();
                await loadFinance();
                await loadAnalytics();
                
                // Check reminders
                checkReminders();
                
                // Show default page
                showPage('dashboard');
                
                // Make functions globally available
                makeGloballyAvailable();
                
                // Setup additional event listeners for new features
                setTimeout(() => {
                    setupNewFeatureListeners();
                    setupDirectEventListeners(); // Add direct listeners as backup
                    console.log('✅ All features initialized successfully!');
                }, 1000);
                
            } catch (error) {
                console.error('❌ Error initializing app:', error);
                showSnackbar('Error initializing app. Please refresh the page.');
            }
        });

        // Initialize DOM elements
        function initializeDOMElements() {
            sidebar = document.getElementById('sidebar');
            menuToggle = document.getElementById('menuToggle');
            fab = document.getElementById('fab');
            quickAddMenu = document.getElementById('quickAddMenu');
            notificationBtn = document.getElementById('notificationBtn');
            notificationPanel = document.getElementById('notificationPanel');
            addLeadModal = document.getElementById('addLeadModal');
            addProjectModal = document.getElementById('addProjectModal');
            
            console.log('📋 DOM Elements initialized:', {
                sidebar: !!sidebar,
                menuToggle: !!menuToggle,
                fab: !!fab,
                quickAddMenu: !!quickAddMenu
            });
        }

        // Setup direct event listeners as backup
        function setupDirectEventListeners() {
            console.log('🔧 Setting up direct event listeners...');
            
            // FAB click handler
            const fabElement = document.getElementById('fab');
            if (fabElement) {
                fabElement.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 FAB clicked directly');
                    const menu = document.getElementById('quickAddMenu');
                    if (menu) {
                        menu.classList.toggle('show');
                        console.log('📋 Quick add menu toggled');
                    }
                };
                console.log('✅ FAB direct listener attached');
            }
            
            // Quick add menu items
            document.querySelectorAll('.quick-add-item').forEach((item, index) => {
                item.onclick = function(e) {
                    e.preventDefault();
                    const action = this.dataset.action;
                    console.log(`🎯 Quick add item ${index} clicked:`, action);
                    handleQuickAddDirect(action);
                    document.getElementById('quickAddMenu').classList.remove('show');
                };
                console.log(`✅ Quick add item ${index} direct listener attached`);
            });
            
            // Add Task button
            const addTaskBtn = document.getElementById('addTaskBtn');
            if (addTaskBtn) {
                addTaskBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 Add Task button clicked directly');
                    openModalDirect('addTaskModal');
                };
                console.log('✅ Add Task button direct listener attached');
            }
            
            // Add Reminder button
            const addReminderBtn = document.getElementById('addReminderBtn');
            if (addReminderBtn) {
                addReminderBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 Add Reminder button clicked directly');
                    openModalDirect('addReminderModal');
                };
                console.log('✅ Add Reminder button direct listener attached');
            }
            
            // Add Transaction button
            const addTransactionBtn = document.getElementById('addTransactionBtn');
            if (addTransactionBtn) {
                addTransactionBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 Add Transaction button clicked directly');
                    openModalDirect('addTransactionModal');
                };
                console.log('✅ Add Transaction button direct listener attached');
            }
            
            // Menu toggle
            const menuToggleElement = document.getElementById('menuToggle');
            if (menuToggleElement) {
                menuToggleElement.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 Menu toggle clicked directly');
                    const sidebarElement = document.getElementById('sidebar');
                    if (sidebarElement) {
                        sidebarElement.classList.toggle('open');
                    }
                };
                console.log('✅ Menu toggle direct listener attached');
            }
            
            // Navigation links
            document.querySelectorAll('.nav-link').forEach((link, index) => {
                link.onclick = function(e) {
                    e.preventDefault();
                    const page = this.dataset.page;
                    console.log(`🎯 Nav link ${index} clicked:`, page);
                    showPage(page);
                    document.getElementById('sidebar').classList.remove('open');
                };
                console.log(`✅ Nav link ${index} direct listener attached`);
            });
            
            console.log('✅ All direct event listeners set up');
        }

        // Direct modal opener
        function openModalDirect(modalId) {
            console.log('🔓 Opening modal directly:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                console.log('✅ Modal opened:', modalId);
                
                // Add close functionality
                const closeBtn = modal.querySelector('.close-btn, .modal-close');
                if (closeBtn) {
                    closeBtn.onclick = function() {
                        modal.style.display = 'none';
                        console.log('✅ Modal closed:', modalId);
                    };
                }
                
                // Close on backdrop click
                modal.onclick = function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        console.log('✅ Modal closed by backdrop:', modalId);
                    }
                };
            } else {
                console.error('❌ Modal not found:', modalId);
                showSnackbar('❌ Modal not available: ' + modalId);
            }
        }

        // Direct quick add handler
        function handleQuickAddDirect(action) {
            console.log('🚀 Direct quick add:', action);
            switch(action) {
                case 'task':
                    openModalDirect('addTaskModal');
                    break;
                case 'reminder':
                    openModalDirect('addReminderModal');
                    break;
                case 'transaction':
                    openModalDirect('addTransactionModal');
                    break;
                case 'lead':
                    openModalDirect('addLeadModal');
                    break;
                case 'project':
                    openModalDirect('addProjectModal');
                    break;
                default:
                    console.log('❓ Unknown action:', action);
                    showSnackbar('❓ Unknown action: ' + action);
            }
        }

        // Event Listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    showPage(page);
                    // Auto-close sidebar on mobile after navigation
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('open');
                    }
                });
            });

            // Menu Toggle
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });

            // Close Sidebar
            document.getElementById('closeSidebar').addEventListener('click', () => {
                sidebar.classList.remove('open');
            });

            // FAB and Quick Add
            fab.addEventListener('click', () => {
                quickAddMenu.classList.toggle('show');
            });

            // Quick Add Actions - Enhanced
            document.querySelectorAll('.quick-add-item').forEach(item => {
                item.addEventListener('click', () => {
                    const action = item.dataset.action;
                    enhancedHandleQuickAdd(action);
                    quickAddMenu.classList.remove('show');
                });
            });

            // Notifications
            notificationBtn.addEventListener('click', () => {
                notificationPanel.classList.toggle('show');
            });

            // Clear Notifications
            document.getElementById('clearNotifications').addEventListener('click', () => {
                clearNotifications();
            });

            // Add Lead Button
            document.getElementById('addLeadBtn').addEventListener('click', () => {
                addLeadModal.classList.add('show');
            });

            // Cancel Add Lead
            document.getElementById('cancelAddLead').addEventListener('click', () => {
                addLeadModal.classList.remove('show');
                resetAddLeadForm();
            });

            document.getElementById('cancelAddLead2').addEventListener('click', () => {
                addLeadModal.classList.remove('show');
                resetAddLeadForm();
            });

            // Add Lead Form
            document.getElementById('addLeadForm').addEventListener('submit', handleAddLead);

            // Add Project Button
            document.getElementById('addProjectBtn').addEventListener('click', () => {
                addProjectModal.classList.add('show');
                populateLeadDropdown();
            });

            // Cancel Add Project
            document.getElementById('cancelAddProject').addEventListener('click', () => {
                addProjectModal.classList.remove('show');
                resetAddProjectForm();
            });

            document.getElementById('cancelAddProject2').addEventListener('click', () => {
                addProjectModal.classList.remove('show');
                resetAddProjectForm();
            });

            // Add Project Form
            document.getElementById('addProjectForm').addEventListener('submit', handleAddProject);

            // Save Settings
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);

            // Custom Dropdown Functionality
            setupCustomDropdowns();

            // Close modals and panels when clicking outside
            document.addEventListener('click', (e) => {
                if (!fab.contains(e.target) && !quickAddMenu.contains(e.target)) {
                    quickAddMenu.classList.remove('show');
                }
            });

            // Close notification panel when clicking outside
            document.addEventListener('click', (e) => {
                if (!notificationBtn.contains(e.target) && !notificationPanel.contains(e.target)) {
                    notificationPanel.classList.remove('show');
                }
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && 
                    !sidebar.contains(e.target) && 
                    !menuToggle.contains(e.target) && 
                    sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            });

            // Close modal when clicking overlay
            addLeadModal.addEventListener('click', (e) => {
                if (e.target === addLeadModal) {
                    addLeadModal.classList.remove('show');
                    resetAddLeadForm();
                }
            });

            addProjectModal.addEventListener('click', (e) => {
                if (e.target === addProjectModal) {
                    addProjectModal.classList.remove('show');
                    resetAddProjectForm();
                }
            });
        }

        // Page Navigation
        function showPage(pageId) {
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === pageId) {
                    link.classList.add('active');
                }
            });

            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            const icons = {
                dashboard: 'dashboard',
                leads: 'people',
                projects: 'folder',
                finance: 'account_balance',
                tasks: 'task',
                analytics: 'analytics',
                reminders: 'notifications',
                settings: 'settings'
            };

            const titles = {
                dashboard: 'Dashboard',
                leads: 'Lead Management',
                projects: 'Project Management',
                finance: 'Finance',
                tasks: "Today's Work",
                analytics: 'Analytics',
                reminders: 'Reminders',
                settings: 'Settings'
            };

            pageTitle.innerHTML = `
                <span class="material-symbols-outlined">${icons[pageId]}</span>
                ${titles[pageId]}
            `;

            // Show/hide pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            // Load page-specific data
            switch (pageId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'leads':
                    loadLeads();
                    break;
                case 'projects':
                    loadProjects();
                    break;
                case 'tasks':
                    loadTasks();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'reminders':
                    loadReminders();
                    break;
            }

            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('open');
            }
        }

        // Quick Add Handler
        function handleQuickAdd(action) {
            switch (action) {
                case 'lead':
                    addLeadModal.classList.add('show');
                    break;
                case 'project':
                    addProjectModal.classList.add('show');
                    populateLeadDropdown();
                    break;
                case 'task':
                    showSnackbar('Task creation coming soon!');
                    break;
                case 'reminder':
                    showSnackbar('Reminder creation coming soon!');
                    break;
                case 'transaction':
                    showSnackbar('Transaction creation coming soon!');
                    break;
            }
        }

        // Custom Dropdown Setup
        function setupCustomDropdowns() {
            document.querySelectorAll('.custom-dropdown').forEach(dropdown => {
                const button = dropdown.querySelector('.custom-dropdown-button');
                const menu = dropdown.querySelector('.custom-dropdown-menu');
                const field = button.dataset.field;

                button.addEventListener('click', () => {
                    // Close other dropdowns
                    document.querySelectorAll('.custom-dropdown-menu').forEach(m => {
                        if (m !== menu) m.classList.remove('show');
                    });
                    menu.classList.toggle('show');
                });

                menu.addEventListener('click', (e) => {
                    if (e.target.classList.contains('custom-dropdown-item')) {
                        if (e.target.classList.contains('add-custom')) {
                            handleAddCustomOption(field, button);
                        } else {
                            const value = e.target.dataset.value;
                            button.querySelector('span').textContent = e.target.textContent;
                            button.dataset.value = value;
                        }
                        menu.classList.remove('show');
                    }
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.custom-dropdown')) {
                    document.querySelectorAll('.custom-dropdown-menu').forEach(menu => {
                        menu.classList.remove('show');
                    });
                }
            });
        }

        // Handle Add Custom Option
        function handleAddCustomOption(field, button) {
            const customValue = prompt(`Enter custom ${field}:`);
            if (customValue && customValue.trim()) {
                const menu = button.nextElementSibling;
                const addCustomItem = menu.querySelector('.add-custom');
                
                // Create new option
                const newItem = document.createElement('div');
                newItem.className = 'custom-dropdown-item';
                newItem.dataset.value = customValue.trim();
                newItem.textContent = customValue.trim();
                
                // Insert before "Add Custom" option
                menu.insertBefore(newItem, addCustomItem);
                
                // Select the new option
                button.querySelector('span').textContent = customValue.trim();
                button.dataset.value = customValue.trim();
                
                showSnackbar(`Custom ${field} "${customValue.trim()}" added successfully!`);
            }
        }

        // Add Lead Form Handler
        async function handleAddLead(e) {
            e.preventDefault();
            
            const modal = document.getElementById('addLeadModal');
            const editId = modal.getAttribute('data-edit-id');
            
            const leadData = {
                companyName: document.getElementById('companyName').value,
                contactPerson: document.getElementById('contactPerson').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                website: document.getElementById('website').value,
                category: document.querySelector('[data-field="category"]').dataset.value || '',
                stage: document.querySelector('[data-field="stage"]').dataset.value || '',
                priority: document.querySelector('[data-field="priority"]').dataset.value || '',
                leadOwner: document.getElementById('leadOwner').value,
                dealAmount: parseFloat(document.getElementById('dealAmount').value) || 0,
                currency: document.querySelector('[data-field="currency"]').dataset.value || 'INR',
                meetingDateTime: document.getElementById('meetingDateTime').value,
                meetingTopic: document.getElementById('meetingTopic').value,
                meetingType: document.querySelector('[data-field="meetingType"]').dataset.value || '',
                reminderTime: parseInt(document.querySelector('[data-field="reminderTime"]').dataset.value) || 30,
                notes: document.getElementById('notes').value,
                updatedAt: new Date().toISOString()
            };

            try {
                if (editId) {
                    // Update existing lead
                    leadData.id = editId;
                    const leadRef = ref(database, `leads/${editId}`);
                    await update(leadRef, leadData);
                    showSnackbar('Lead updated successfully!');
                    addNotificationToPanel(`Lead "${leadData.companyName}" updated successfully!`, 'lead');
                } else {
                    // Create new lead
                    leadData.id = Date.now().toString();
                    leadData.createdAt = new Date().toISOString();
                    const leadRef = ref(database, `leads/${leadData.id}`);
                    await set(leadRef, leadData);
                    showSnackbar('Lead added successfully!');
                    addNotificationToPanel(`New lead "${leadData.companyName}" added successfully!`, 'lead');
                }
                
                modal.classList.remove('show');
                modal.removeAttribute('data-edit-id');
                resetAddLeadForm();
                loadLeads();
                loadDashboard();
                
                // Schedule reminder if meeting is set
                if (leadData.meetingDateTime) {
                    scheduleReminder(leadData);
                }
            } catch (error) {
                console.error('Error saving lead:', error);
                showSnackbar('Error saving lead. Please try again.');
            }
        }

        // Add Project Form Handler
        async function handleAddProject(e) {
            e.preventDefault();

            const projectName = document.getElementById('projectName').value;
            const leadId = document.querySelector('[data-field="projectLead"]').dataset.value;

            if (!projectName) {
                showSnackbar('Please enter project name');
                return;
            }

            const projectData = {
                id: Date.now().toString(),
                name: projectName,
                leadId: leadId || null,
                status: 'Active',
                createdAt: new Date().toISOString()
            };

            try {
                const projectRef = ref(database, `projects/${projectData.id}`);
                await set(projectRef, projectData);
                showSnackbar('Project added successfully!');
                addNotificationToPanel(`New project "${projectName}" created successfully!`, 'task');
                addProjectModal.classList.remove('show');
                resetAddProjectForm();
                loadProjects();
                loadDashboard();
            } catch (error) {
                console.error('Error saving project:', error);
                showSnackbar('Error saving project. Please try again.');
            }
        }

        // Reset Add Lead Form
        function resetAddLeadForm() {
            document.getElementById('addLeadForm').reset();
            
            // Reset custom dropdowns
            document.querySelectorAll('.custom-dropdown-button').forEach(button => {
                const defaultText = {
                    category: 'Select Category',
                    stage: 'Select Stage',
                    priority: 'Select Priority',
                    currency: 'INR',
                    meetingType: 'Select Meeting Type',
                    reminderTime: 'Reminder Time'
                };
                
                const field = button.dataset.field;
                button.querySelector('span').textContent = defaultText[field] || 'Select Option';
                button.dataset.value = field === 'currency' ? 'INR' : '';
            });
        }

        // Reset Add Project Form
        function resetAddProjectForm() {
            document.getElementById('addProjectForm').reset();
            document.querySelector('[data-field="projectLead"]').querySelector('span').textContent = 'Select Lead (Optional)';
            document.querySelector('[data-field="projectLead"]').dataset.value = '';
        }

        // Load Dashboard
        async function loadDashboard() {
            try {
                const [leadsSnapshot, projectsSnapshot] = await Promise.all([
                    get(ref(database, 'leads')),
                    get(ref(database, 'projects'))
                ]);
                
                let totalLeads = 0;
                let totalRevenue = 0;
                let newLeads = 0;
                
                if (leadsSnapshot.exists()) {
                    const leads = Object.values(leadsSnapshot.val());
                    totalLeads = leads.length;
                    
                    // Calculate revenue
                    totalRevenue = leads.reduce((sum, lead) => sum + (lead.dealAmount || 0), 0);
                    
                    // Count new leads (created in last 30 days)
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    newLeads = leads.filter(lead => new Date(lead.createdAt) > thirtyDaysAgo).length;
                }

                let activeProjects = 0;
                if (projectsSnapshot.exists()) {
                    const projects = Object.values(projectsSnapshot.val());
                    activeProjects = projects.filter(p => p.status === 'Active').length;
                    
                    const recentProjectsTable = document.getElementById('recentProjectsTable');
                    if (projects.length > 0) {
                        recentProjectsTable.innerHTML = projects.slice(0, 5).map(project => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--md-sys-color-outline-variant);">
                                <div>
                                    <div style="font-weight: 500;">${project.name}</div>
                                    <div style="font-size: 14px; color: var(--md-sys-color-on-surface-variant);">Created: ${new Date(project.createdAt).toLocaleDateString()}</div>
                                </div>
                                <span class="priority-badge medium">${project.status}</span>
                            </div>
                        `).join('');
                    }
                }

                // Update dashboard stats
                document.getElementById('totalLeads').textContent = totalLeads;
                document.getElementById('activeProjects').textContent = activeProjects;
                document.getElementById('totalRevenue').textContent = `₹${totalRevenue.toLocaleString()}`;
                document.getElementById('pendingTasks').textContent = '0'; // Will be updated when tasks are implemented
                
                // Update detailed stats
                document.getElementById('newLeads').textContent = newLeads;
                document.getElementById('conversionRate').textContent = totalLeads > 0 ? Math.round((newLeads / totalLeads) * 100) + '%' : '0%';
                document.getElementById('avgDealSize').textContent = totalLeads > 0 ? Math.round(totalRevenue / totalLeads).toLocaleString() : '0';
                document.getElementById('monthlyGrowth').textContent = '0%'; // Will be calculated based on historical data
                
                document.getElementById('completedProjects').textContent = '0'; // Will be updated when project status tracking is implemented
                document.getElementById('inProgressProjects').textContent = activeProjects;
                document.getElementById('avgCompletion').textContent = '0';
                document.getElementById('successRate').textContent = '0%';
                
                document.getElementById('monthlyRevenue').textContent = totalRevenue.toLocaleString();
                document.getElementById('totalExpenses').textContent = '0'; // Will be updated when expense tracking is implemented
                document.getElementById('netProfit').textContent = totalRevenue.toLocaleString();
                document.getElementById('revenueGrowth').textContent = '0%';
                
                document.getElementById('dueToday').textContent = '0';
                document.getElementById('dueThisWeek').textContent = '0';
                document.getElementById('overdue').textContent = '0';
                document.getElementById('completedThisWeek').textContent = '0';
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Load Leads
        async function loadLeads() {
            try {
                const leadsRef = ref(database, 'leads');
                const snapshot = await get(leadsRef);
                
                const leadsContainer = document.getElementById('leadsContainer');
                
                if (snapshot.exists()) {
                    const leads = Object.values(snapshot.val());
                    
                    leadsContainer.innerHTML = leads.map(lead => `
                        <div class="md-card mb-16" style="margin-bottom: 16px;">
                            <div class="md-card-content">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                    <div>
                                        <h4 style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">${lead.companyName}</h4>
                                        <p style="color: var(--md-sys-color-on-surface-variant); margin-bottom: 4px;">${lead.contactPerson}</p>
                                        <p style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;">${lead.email}</p>
                                        ${lead.meetingDateTime ? `<p style="color: var(--md-sys-color-primary); font-size: 14px; margin-top: 8px;"><span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">event</span> ${new Date(lead.meetingDateTime).toLocaleString()}</p>` : ''}
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <button class="md-icon-button" onclick="editLead('${lead.id}')">
                                            <span class="material-symbols-outlined">edit</span>
                                        </button>
                                        <button class="md-icon-button" onclick="deleteLead('${lead.id}')">
                                            <span class="material-symbols-outlined">delete</span>
                                        </button>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <span class="priority-badge ${lead.priority?.toLowerCase() || 'medium'}">${lead.priority || 'Medium'}</span>
                                    <span style="background-color: var(--md-sys-color-surface-variant); color: var(--md-sys-color-on-surface-variant); padding: 4px 8px; border-radius: 12px; font-size: 12px;">${lead.stage || 'New Lead'}</span>
                                    <span style="background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); padding: 4px 8px; border-radius: 12px; font-size: 12px;">${lead.currency} ${lead.dealAmount?.toLocaleString() || '0'}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    leadsContainer.innerHTML = `
                        <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                            No leads yet. Add your first lead to get started!
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error loading leads:', error);
            }
        }

        // Load Projects
        async function loadProjects() {
            try {
                const projectsRef = ref(database, 'projects');
                const snapshot = await get(projectsRef);
                
                const projectsContainer = document.getElementById('projectsContainer');
                
                if (snapshot.exists()) {
                    const projects = Object.values(snapshot.val());
                    
                    projectsContainer.innerHTML = projects.map(project => `
                        <div class="md-card mb-16" style="margin-bottom: 16px;">
                            <div class="md-card-content">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                    <div>
                                        <h4 style="font-size: 18px; font-weight: 500; margin-bottom: 8px;">${project.name}</h4>
                                        <p style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;">Created: ${new Date(project.createdAt).toLocaleDateString()}</p>
                                        ${project.leadId ? `<p style="color: var(--md-sys-color-primary); font-size: 14px; margin-top: 4px;">Linked to Lead</p>` : ''}
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <button class="md-icon-button" onclick="editProject('${project.id}')">
                                            <span class="material-symbols-outlined">edit</span>
                                        </button>
                                        <button class="md-icon-button" onclick="deleteProject('${project.id}')">
                                            <span class="material-symbols-outlined">delete</span>
                                        </button>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <span class="priority-badge medium">${project.status || 'Active'}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    projectsContainer.innerHTML = `
                        <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                            No projects yet. Create your first project to get started!
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        // Edit Lead
        window.editLead = async function(leadId) {
            try {
                const leadRef = ref(database, `leads/${leadId}`);
                const snapshot = await get(leadRef);
                
                if (snapshot.exists()) {
                    const leadData = snapshot.val();
                    
                    // Populate form with existing data
                    document.getElementById('companyName').value = leadData.companyName || '';
                    document.getElementById('contactPerson').value = leadData.contactPerson || '';
                    document.getElementById('email').value = leadData.email || '';
                    document.getElementById('phone').value = leadData.phone || '';
                    document.getElementById('leadOwner').value = leadData.leadOwner || '';
                    document.getElementById('dealAmount').value = leadData.dealAmount || '';
                    document.getElementById('notes').value = leadData.notes || '';
                    document.getElementById('website').value = leadData.website || '';
                    document.getElementById('meetingDateTime').value = leadData.meetingDateTime || '';
                    document.getElementById('meetingTopic').value = leadData.meetingTopic || '';
                    
                    // Set dropdown values
                    if (leadData.category) {
                        const categoryBtn = document.querySelector('[data-field="category"]');
                        categoryBtn.querySelector('span').textContent = leadData.category;
                        categoryBtn.dataset.value = leadData.category;
                    }
                    
                    if (leadData.stage) {
                        const stageBtn = document.querySelector('[data-field="stage"]');
                        stageBtn.querySelector('span').textContent = leadData.stage;
                        stageBtn.dataset.value = leadData.stage;
                    }
                    
                    if (leadData.priority) {
                        const priorityBtn = document.querySelector('[data-field="priority"]');
                        priorityBtn.querySelector('span').textContent = leadData.priority;
                        priorityBtn.dataset.value = leadData.priority;
                    }
                    
                    if (leadData.currency) {
                        const currencyBtn = document.querySelector('[data-field="currency"]');
                        currencyBtn.querySelector('span').textContent = leadData.currency;
                        currencyBtn.dataset.value = leadData.currency;
                    }
                    
                    if (leadData.meetingType) {
                        const meetingTypeBtn = document.querySelector('[data-field="meetingType"]');
                        meetingTypeBtn.querySelector('span').textContent = leadData.meetingType;
                        meetingTypeBtn.dataset.value = leadData.meetingType;
                    }
                    
                    if (leadData.reminderTime) {
                        const reminderBtn = document.querySelector('[data-field="reminderTime"]');
                        reminderBtn.querySelector('span').textContent = `${leadData.reminderTime} minutes before`;
                        reminderBtn.dataset.value = leadData.reminderTime;
                    }
                    
                    // Store the lead ID for updating
                    const modal = document.getElementById('addLeadModal');
                    modal.setAttribute('data-edit-id', leadId);
                    
                    // Show modal
                    modal.classList.add('show');
                    showSnackbar('Lead data loaded for editing');
                } else {
                    showSnackbar('Lead not found');
                }
            } catch (error) {
                console.error('Error loading lead for edit:', error);
                showSnackbar('Error loading lead data');
            }
        };

        // Delete Lead
        window.deleteLead = async function(leadId) {
            if (confirm('Are you sure you want to delete this lead?')) {
                try {
                    const leadRef = ref(database, `leads/${leadId}`);
                    await remove(leadRef);
                    showSnackbar('Lead deleted successfully!');
                    addNotificationToPanel('Lead deleted successfully!', 'lead');
                    loadLeads();
                    loadDashboard();
                } catch (error) {
                    console.error('Error deleting lead:', error);
                    showSnackbar('Error deleting lead');
                }
            }
        };

        // Edit Project
        window.editProject = async function(projectId) {
            showSnackbar('Project editing coming soon!');
        };

        // Delete Project
        window.deleteProject = async function(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                try {
                    const projectRef = ref(database, `projects/${projectId}`);
                    await remove(projectRef);
                    showSnackbar('Project deleted successfully!');
                    addNotificationToPanel('Project deleted successfully!', 'task');
                    loadProjects();
                    loadDashboard();
                } catch (error) {
                    console.error('Error deleting project:', error);
                    showSnackbar('Error deleting project');
                }
            }
        };

        // Populate Lead Dropdown
        async function populateLeadDropdown() {
            try {
                const leadsRef = ref(database, 'leads');
                const snapshot = await get(leadsRef);
                
                const dropdownMenu = document.getElementById('projectLeadDropdown');
                dropdownMenu.innerHTML = '<div class="custom-dropdown-item" data-value="">No Lead Selected</div>';
                
                if (snapshot.exists()) {
                    const leads = Object.values(snapshot.val());
                    leads.forEach(lead => {
                        dropdownMenu.innerHTML += `<div class="custom-dropdown-item" data-value="${lead.id}">${lead.companyName}</div>`;
                    });
                }
            } catch (error) {
                console.error('Error populating lead dropdown:', error);
            }
        }

        // Load Tasks
        async function loadTasks() {
            try {
                console.log('📥 Loading tasks from Firebase...');
                const tasksRef = ref(database, 'tasks');
                const snapshot = await get(tasksRef);
                
                const tasksContainer = document.getElementById('tasksContainer');
                
                if (snapshot.exists()) {
                    const tasks = Object.entries(snapshot.val()).map(([id, task]) => ({id, ...task}));
                    console.log(`📋 Loaded ${tasks.length} tasks`);
                    
                    // Update task summary counts
                    updateTaskSummary(tasks);
                    
                    // Render tasks
                    renderTasks(tasks);
                    return tasks;
                } else {
                    console.log('📋 No tasks found');
                    tasksContainer.innerHTML = `
                        <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                            No tasks yet. Add your first task to get started!
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
                showSnackbar('Error loading tasks');
            }
        }

        // Update Task Summary
        function updateTaskSummary(tasks) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            const pending = tasks.filter(task => task.status !== 'completed').length;
            const completedToday = tasks.filter(task => {
                if (task.status === 'completed' && task.completedAt) {
                    const completedDate = new Date(task.completedAt);
                    return completedDate >= today;
                }
                return false;
            }).length;
            const dueToday = tasks.filter(task => {
                if (task.dueDate) {
                    const dueDate = new Date(task.dueDate);
                    return dueDate.toDateString() === today.toDateString() && task.status !== 'completed';
                }
                return false;
            }).length;
            const highPriority = tasks.filter(task => task.priority === 'High' || task.priority === 'Urgent').length;
            
            document.getElementById('pendingTasksCount').textContent = pending;
            document.getElementById('completedTasksCount').textContent = completedToday;
            document.getElementById('dueTodayCount').textContent = dueToday;
            document.getElementById('highPriorityCount').textContent = highPriority;
        }

        // Render Tasks
        function renderTasks(tasks, filter = 'all') {
            const tasksContainer = document.getElementById('tasksContainer');
            
            let filteredTasks = tasks;
            const now = new Date();
            
            switch (filter) {
                case 'pending':
                    filteredTasks = tasks.filter(task => task.status !== 'completed');
                    break;
                case 'completed':
                    filteredTasks = tasks.filter(task => task.status === 'completed');
                    break;
                case 'overdue':
                    filteredTasks = tasks.filter(task => {
                        if (task.dueDate && task.status !== 'completed') {
                            return new Date(task.dueDate) < now;
                        }
                        return false;
                    });
                    break;
                case 'high':
                    filteredTasks = tasks.filter(task => task.priority === 'High' || task.priority === 'Urgent');
                    break;
            }
            
            if (filteredTasks.length === 0) {
                tasksContainer.innerHTML = `
                    <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                        No tasks found for the selected filter.
                    </p>
                `;
                return;
            }
            
            const tasksHTML = filteredTasks.map(task => {
                const dueDate = task.dueDate ? new Date(task.dueDate) : null;
                const isOverdue = dueDate && dueDate < now && task.status !== 'completed';
                
                return `
                    <div class="task-item ${task.status === 'completed' ? 'completed' : ''}" data-task-id="${task.id}">
                        <input type="checkbox" class="task-checkbox" ${task.status === 'completed' ? 'checked' : ''} 
                               onchange="toggleTaskStatus('${task.id}', this.checked)">
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span class="priority-badge ${task.priority?.toLowerCase() || 'medium'}">${task.priority || 'Medium'}</span>
                                <span>${task.category || 'General'}</span>
                                ${dueDate ? `<span ${isOverdue ? 'style="color: #F44336;"' : ''}>${dueDate.toLocaleString()}</span>` : ''}
                                ${isOverdue ? '<span style="color: #F44336;">OVERDUE</span>' : ''}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="md-icon-button" onclick="editTask('${task.id}')">
                                <span class="material-symbols-outlined">edit</span>
                            </button>
                            <button class="md-icon-button" onclick="deleteTask('${task.id}')">
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            tasksContainer.innerHTML = tasksHTML;
        }

        // Load Analytics
        async function loadAnalytics() {
            try {
                const [leadsSnapshot, projectsSnapshot, tasksSnapshot, transactionsSnapshot] = await Promise.all([
                    get(ref(database, 'leads')),
                    get(ref(database, 'projects')),
                    get(ref(database, 'tasks')),
                    get(ref(database, 'transactions'))
                ]);
                
                const leads = leadsSnapshot.exists() ? Object.values(leadsSnapshot.val()) : [];
                const projects = projectsSnapshot.exists() ? Object.values(projectsSnapshot.val()) : [];
                const tasks = tasksSnapshot.exists() ? Object.values(tasksSnapshot.val()) : [];
                const transactions = transactionsSnapshot.exists() ? Object.values(transactionsSnapshot.val()) : [];
                
                // Calculate analytics
                calculateAnalytics(leads, projects, tasks, transactions);
            } catch (error) {
                console.error('Error loading analytics:', error);
                showSnackbar('Error loading analytics data');
            }
        }

        // Calculate Analytics
        function calculateAnalytics(leads, projects, tasks, transactions) {
            // Lead conversion rate
            const convertedLeads = leads.filter(lead => lead.stage === 'Converted').length;
            const conversionRate = leads.length > 0 ? ((convertedLeads / leads.length) * 100).toFixed(1) : 0;
            
            // Task completion rate
            const completedTasks = tasks.filter(task => task.status === 'completed').length;
            const taskCompletionRate = tasks.length > 0 ? ((completedTasks / tasks.length) * 100).toFixed(1) : 0;
            
            // Average project duration (mock calculation)
            const avgProjectDuration = projects.length > 0 ? Math.round(Math.random() * 30 + 15) : 0;
            
            // Monthly growth (mock calculation)
            const monthlyGrowth = Math.round(Math.random() * 20 + 5);
            
            // Productivity score (based on task completion and project progress)
            const productivityScore = Math.round((parseFloat(taskCompletionRate) + Math.random() * 20) / 2);
            
            // Update analytics display
            document.getElementById('monthlyGrowthRate').textContent = `${monthlyGrowth}%`;
            document.getElementById('leadConversionRate').textContent = `${conversionRate}%`;
            document.getElementById('avgProjectDuration').textContent = avgProjectDuration;
            document.getElementById('productivityScore').textContent = `${productivityScore}%`;
            document.getElementById('taskCompletionRate').textContent = `${taskCompletionRate}%`;
            document.getElementById('onTimeDeliveryRate').textContent = `${Math.round(Math.random() * 30 + 70)}%`;
            document.getElementById('clientSatisfactionRate').textContent = `${Math.round(Math.random() * 20 + 80)}%`;
        }

        // Load Reminders
        async function loadReminders() {
            try {
                const remindersRef = ref(database, 'reminders');
                const snapshot = await get(remindersRef);
                
                const remindersContainer = document.getElementById('remindersContainer');
                
                if (snapshot.exists()) {
                    const reminders = Object.entries(snapshot.val()).map(([id, reminder]) => ({id, ...reminder}));
                    
                    // Update reminder summary counts
                    updateReminderSummary(reminders);
                    
                    // Render reminders
                    renderReminders(reminders);
                } else {
                    remindersContainer.innerHTML = `
                        <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                            No reminders yet. Add your first reminder to get started!
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error loading reminders:', error);
                showSnackbar('Error loading reminders');
            }
        }

        // Update Reminder Summary
        function updateReminderSummary(reminders) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const upcoming = reminders.filter(reminder => {
                const reminderDate = new Date(reminder.dateTime);
                return reminderDate > now && reminder.status !== 'completed';
            }).length;
            
            const todayReminders = reminders.filter(reminder => {
                const reminderDate = new Date(reminder.dateTime);
                return reminderDate.toDateString() === today.toDateString() && reminder.status !== 'completed';
            }).length;
            
            const recurring = reminders.filter(reminder => reminder.repeat && reminder.repeat !== 'None').length;
            const active = reminders.filter(reminder => reminder.status !== 'completed').length;
            
            document.getElementById('upcomingRemindersCount').textContent = upcoming;
            document.getElementById('todayRemindersCount').textContent = todayReminders;
            document.getElementById('recurringRemindersCount').textContent = recurring;
            document.getElementById('activeRemindersCount').textContent = active;
        }

        // Render Reminders
        function renderReminders(reminders, filter = 'all') {
            const remindersContainer = document.getElementById('remindersContainer');
            
            let filteredReminders = reminders;
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            switch (filter) {
                case 'today':
                    filteredReminders = reminders.filter(reminder => {
                        const reminderDate = new Date(reminder.dateTime);
                        return reminderDate.toDateString() === today.toDateString();
                    });
                    break;
                case 'upcoming':
                    filteredReminders = reminders.filter(reminder => {
                        const reminderDate = new Date(reminder.dateTime);
                        return reminderDate > now && reminder.status !== 'completed';
                    });
                    break;
                case 'recurring':
                    filteredReminders = reminders.filter(reminder => reminder.repeat && reminder.repeat !== 'None');
                    break;
                case 'completed':
                    filteredReminders = reminders.filter(reminder => reminder.status === 'completed');
                    break;
            }
            
            if (filteredReminders.length === 0) {
                remindersContainer.innerHTML = `
                    <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                        No reminders found for the selected filter.
                    </p>
                `;
                return;
            }
            
            const remindersHTML = filteredReminders.map(reminder => {
                const reminderDate = new Date(reminder.dateTime);
                const isPast = reminderDate < now;
                
                return `
                    <div class="reminder-item" data-reminder-id="${reminder.id}">
                        <div class="reminder-icon">
                            <span class="material-symbols-outlined">${getReminderIcon(reminder.type)}</span>
                        </div>
                        <div class="reminder-content">
                            <div class="reminder-title">${reminder.title}</div>
                            <div class="reminder-meta">
                                <span class="status-badge ${reminder.status || 'pending'}">${reminder.status || 'Pending'}</span>
                                <span>${reminder.type || 'General'}</span>
                                <span ${isPast ? 'style="color: #F44336;"' : ''}>${reminderDate.toLocaleString()}</span>
                                ${reminder.repeat && reminder.repeat !== 'None' ? `<span>Repeats ${reminder.repeat}</span>` : ''}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="md-icon-button" onclick="markReminderComplete('${reminder.id}')">
                                <span class="material-symbols-outlined">check</span>
                            </button>
                            <button class="md-icon-button" onclick="editReminder('${reminder.id}')">
                                <span class="material-symbols-outlined">edit</span>
                            </button>
                            <button class="md-icon-button" onclick="deleteReminder('${reminder.id}')">
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            remindersContainer.innerHTML = remindersHTML;
        }

        // Get Reminder Icon
        function getReminderIcon(type) {
            const icons = {
                'Meeting': 'event',
                'Payment': 'payments',
                'Follow-up': 'call',
                'Deadline': 'schedule',
                'Personal': 'person'
            };
            return icons[type] || 'notifications';
        }

        // Setup Notifications
        function setupNotifications() {
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // Add Notification to Panel
        function addNotificationToPanel(message, type = 'task') {
            const notificationList = document.getElementById('notificationList');
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Remove "no notifications" message if it exists
            const noNotificationsMsg = notificationList.querySelector('div[style*="text-align: center"]');
            if (noNotificationsMsg) {
                noNotificationsMsg.remove();
            }
            
            const notificationHTML = `
                <div class="notification-item">
                    <div class="notification-icon ${type}">
                        <span class="material-symbols-outlined">${type === 'meeting' ? 'event' : type === 'lead' ? 'person' : type === 'reminder' ? 'alarm' : 'task_alt'}</span>
                    </div>
                    <div class="notification-content">
                        <div class="notification-text">${message}</div>
                        <div class="notification-time">${timeString}</div>
                    </div>
                </div>
            `;
            
            notificationList.insertAdjacentHTML('afterbegin', notificationHTML);
        }

        // Clear Notifications
        function clearNotifications() {
            const notificationList = document.getElementById('notificationList');
            notificationList.innerHTML = `
                <div style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                    No notifications yet. Reminders and activities will appear here.
                </div>
            `;
            showSnackbar('Notifications cleared');
        }

        // Schedule Reminder
        function scheduleReminder(leadData) {
            if (leadData.meetingDateTime && leadData.reminderTime) {
                const meetingDate = new Date(leadData.meetingDateTime);
                const now = new Date();
                const reminderTime = leadData.reminderTime * 60 * 1000; // Convert minutes to milliseconds
                const reminderDate = new Date(meetingDate.getTime() - reminderTime);
                
                if (reminderDate > now) {
                    const timeDiff = reminderDate.getTime() - now.getTime();
                    
                    setTimeout(() => {
                        const message = `Meeting reminder: ${leadData.meetingTopic || 'Meeting'} with ${leadData.companyName} in ${leadData.reminderTime} minutes`;
                        addNotificationToPanel(message, 'reminder');
                        
                        // Show push notification if permission granted
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('Meeting Reminder', {
                                body: message,
                                icon: '/favicon.ico'
                            });
                        }
                    }, timeDiff);
                    
                    showSnackbar(`Reminder set for ${leadData.reminderTime} minutes before meeting`);
                }
            }
        }

        // Check Reminders
        async function checkReminders() {
            try {
                const leadsRef = ref(database, 'leads');
                const snapshot = await get(leadsRef);
                
                if (snapshot.exists()) {
                    const leads = Object.values(snapshot.val());
                    const now = new Date();
                    
                    leads.forEach(lead => {
                        if (lead.meetingDateTime) {
                            const meetingDate = new Date(lead.meetingDateTime);
                            const timeDiff = meetingDate.getTime() - now.getTime();
                            const hoursDiff = timeDiff / (1000 * 60 * 60);
                            
                            // Show notification for meetings within next 24 hours
                            if (hoursDiff > 0 && hoursDiff <= 24) {
                                const message = `Upcoming meeting: ${lead.meetingTopic || 'Meeting'} with ${lead.companyName} on ${meetingDate.toLocaleString()}`;
                                addNotificationToPanel(message, 'meeting');
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error checking reminders:', error);
            }
        }

        // Save Settings
        function saveSettings() {
            const settings = {
                profileName: document.getElementById('profileName').value,
                profileEmail: document.getElementById('profileEmail').value,
                profileCompany: document.getElementById('profileCompany').value,
                emailNotifications: document.getElementById('emailNotifications').checked,
                pushNotifications: document.getElementById('pushNotifications').checked,
                meetingReminders: document.getElementById('meetingReminders').checked
            };
            
            // Save to localStorage for now (can be moved to Firebase later)
            localStorage.setItem('businessManagerSettings', JSON.stringify(settings));
            showSnackbar('Settings saved successfully!');
            addNotificationToPanel('Settings updated successfully!', 'task');
        }

        // Show Snackbar
        function showSnackbar(message) {
            const snackbar = document.getElementById('snackbar');
            snackbar.textContent = message;
            snackbar.classList.add('show');
            
            setTimeout(() => {
                snackbar.classList.remove('show');
            }, 3000);
        }

        // Toggle Stat Card Expand/Collapse
        function toggleStatCard(card) {
            const expandBtn = card.querySelector('.stat-card-expand-btn span');
            
            if (card.classList.contains('expanded')) {
                card.classList.remove('expanded');
                expandBtn.textContent = 'expand_more';
            } else {
                card.classList.add('expanded');
                expandBtn.textContent = 'expand_less';
            }
        }

        // Make functions globally available
        window.toggleStatCard = toggleStatCard;
        window.showSnackbar = showSnackbar;
        window.addNotificationToPanel = addNotificationToPanel;
        window.scheduleReminder = scheduleReminder;
        window.checkReminders = checkReminders;

        // Load Finance/Transactions
        async function loadFinance() {
            try {
                const transactionsRef = ref(database, 'transactions');
                const snapshot = await get(transactionsRef);
                
                const financeContainer = document.getElementById('financeContainer');
                
                if (snapshot.exists()) {
                    const transactions = Object.entries(snapshot.val()).map(([id, transaction]) => ({id, ...transaction}));
                    
                    // Update finance summary
                    updateFinanceSummary(transactions);
                    
                    // Render transactions
                    renderTransactions(transactions);
                } else {
                    financeContainer.innerHTML = `
                        <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                            No transactions yet. Add your first transaction to get started!
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
                showSnackbar('Error loading transactions');
            }
        }

        // Update Finance Summary
        function updateFinanceSummary(transactions) {
            const income = transactions.filter(t => t.type === 'Income' && t.status === 'Completed')
                .reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
            const expenses = transactions.filter(t => t.type === 'Expense' && t.status === 'Completed')
                .reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
            const pendingPayments = transactions.filter(t => t.status === 'Pending')
                .reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
            const netProfit = income - expenses;
            
            document.getElementById('totalIncomeValue').textContent = `₹${income.toLocaleString()}`;
            document.getElementById('totalExpenseValue').textContent = `₹${expenses.toLocaleString()}`;
            document.getElementById('netProfitValue').textContent = `₹${netProfit.toLocaleString()}`;
            document.getElementById('pendingPaymentsValue').textContent = `₹${pendingPayments.toLocaleString()}`;
        }

        // Render Transactions
        function renderTransactions(transactions, filter = 'all') {
            const financeContainer = document.getElementById('financeContainer');
            
            let filteredTransactions = transactions;
            const now = new Date();
            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            
            switch (filter) {
                case 'income':
                    filteredTransactions = transactions.filter(t => t.type === 'Income');
                    break;
                case 'expense':
                    filteredTransactions = transactions.filter(t => t.type === 'Expense');
                    break;
                case 'pending':
                    filteredTransactions = transactions.filter(t => t.status === 'Pending');
                    break;
                case 'thisMonth':
                    filteredTransactions = transactions.filter(t => {
                        const transactionDate = new Date(t.date);
                        return transactionDate >= thisMonth;
                    });
                    break;
            }
            
            if (filteredTransactions.length === 0) {
                financeContainer.innerHTML = `
                    <p style="text-align: center; color: var(--md-sys-color-on-surface-variant); padding: 20px;">
                        No transactions found for the selected filter.
                    </p>
                `;
                return;
            }
            
            const transactionsHTML = filteredTransactions.map(transaction => {
                const transactionDate = new Date(transaction.date);
                
                return `
                    <div class="transaction-item" data-transaction-id="${transaction.id}">
                        <div class="transaction-icon ${transaction.type?.toLowerCase() || 'income'}">
                            <span class="material-symbols-outlined">${transaction.type === 'Income' ? 'trending_up' : 'trending_down'}</span>
                        </div>
                        <div class="transaction-content">
                            <div class="transaction-title">${transaction.title}</div>
                            <div class="transaction-meta">
                                <span class="status-badge ${transaction.status?.toLowerCase() || 'completed'}">${transaction.status || 'Completed'}</span>
                                <span>${transaction.category || 'General'}</span>
                                <span>${transactionDate.toLocaleDateString()}</span>
                                ${transaction.client ? `<span>${transaction.client}</span>` : ''}
                            </div>
                        </div>
                        <div class="transaction-amount ${transaction.type?.toLowerCase() || 'income'}">
                            ${transaction.type === 'Expense' ? '-' : '+'}₹${parseFloat(transaction.amount || 0).toLocaleString()}
                        </div>
                        <div class="task-actions">
                            <button class="md-icon-button" onclick="editTransaction('${transaction.id}')">
                                <span class="material-symbols-outlined">edit</span>
                            </button>
                            <button class="md-icon-button" onclick="deleteTransaction('${transaction.id}')">
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            financeContainer.innerHTML = transactionsHTML;
        }

        // Task Management Functions
        async function handleAddTask(e) {
            e.preventDefault();
            console.log('📝 Adding new task...');
            
            try {
                // Get form values safely
                const titleElement = document.getElementById('taskTitle');
                const descriptionElement = document.getElementById('taskDescription');
                const dueDateElement = document.getElementById('taskDueDate');
                
                // Get priority from dropdown or default
                let priority = 'Medium';
                const priorityElement = document.querySelector('[data-field="taskPriority"] span');
                if (priorityElement && priorityElement.textContent !== 'Select Priority') {
                    priority = priorityElement.textContent;
                }
                
                // Get category from dropdown or default
                let category = 'Work';
                const categoryElement = document.querySelector('[data-field="taskCategory"] span');
                if (categoryElement && categoryElement.textContent !== 'Select Category') {
                    category = categoryElement.textContent;
                }
                
                const taskData = {
                    id: Date.now().toString(),
                    title: titleElement ? titleElement.value : '',
                    description: descriptionElement ? descriptionElement.value : '',
                    priority: priority,
                    category: category,
                    dueDate: dueDateElement ? dueDateElement.value : '',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                console.log('📋 Task data:', taskData);
                
                if (!taskData.title) {
                    showSnackbar('❌ Please enter a task title');
                    return;
                }
                
                await set(ref(database, `tasks/${taskData.id}`), taskData);
                document.getElementById('addTaskModal').style.display = 'none';
                resetAddTaskForm();
                await loadTasks();
                await updateTaskSummary();
                showSnackbar('✅ Task added successfully!');
                addNotificationToPanel(`New task created: ${taskData.title}`, 'task');
                
            } catch (error) {
                console.error('❌ Error adding task:', error);
                showSnackbar('❌ Error adding task. Please try again.');
            }
        }

        async function toggleTaskStatus(taskId, isCompleted) {
            try {
                const updates = {
                    status: isCompleted ? 'completed' : 'pending'
                };
                if (isCompleted) {
                    updates.completedAt = new Date().toISOString();
                }
                
                await update(ref(database, `tasks/${taskId}`), updates);
                loadTasks();
                showSnackbar(isCompleted ? 'Task completed!' : 'Task marked as pending');
                
                if (isCompleted) {
                    addNotificationToPanel('Task completed successfully!', 'task');
                }
            } catch (error) {
                console.error('Error updating task:', error);
                showSnackbar('Error updating task');
            }
        }

        async function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                try {
                    await remove(ref(database, `tasks/${taskId}`));
                    loadTasks();
                    showSnackbar('Task deleted successfully');
                } catch (error) {
                    console.error('Error deleting task:', error);
                    showSnackbar('Error deleting task');
                }
            }
        }

        // Reminder Management Functions
        async function handleAddReminder(e) {
            e.preventDefault();
            
            const reminderData = {
                id: Date.now().toString(),
                title: document.getElementById('reminderTitle').value,
                notes: document.getElementById('reminderNotes').value,
                type: document.querySelector('[data-field="reminderType"] span').textContent,
                dateTime: document.getElementById('reminderDateTime').value,
                repeat: document.querySelector('[data-field="reminderRepeat"] span').textContent,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            try {
                await set(ref(database, `reminders/${reminderData.id}`), reminderData);
                document.getElementById('addReminderModal').style.display = 'none';
                resetAddReminderForm();
                loadReminders();
                showSnackbar('Reminder added successfully!');
                addNotificationToPanel(`New reminder set: ${reminderData.title}`, 'reminder');
                
                // Schedule push notification
                scheduleReminderNotification(reminderData);
            } catch (error) {
                console.error('Error adding reminder:', error);
                showSnackbar('Error adding reminder. Please try again.');
            }
        }

        async function markReminderComplete(reminderId) {
            try {
                await update(ref(database, `reminders/${reminderId}`), {
                    status: 'completed',
                    completedAt: new Date().toISOString()
                });
                loadReminders();
                showSnackbar('Reminder marked as completed!');
            } catch (error) {
                console.error('Error updating reminder:', error);
                showSnackbar('Error updating reminder');
            }
        }

        async function deleteReminder(reminderId) {
            if (confirm('Are you sure you want to delete this reminder?')) {
                try {
                    await remove(ref(database, `reminders/${reminderId}`));
                    loadReminders();
                    showSnackbar('Reminder deleted successfully');
                } catch (error) {
                    console.error('Error deleting reminder:', error);
                    showSnackbar('Error deleting reminder');
                }
            }
        }

        // Transaction Management Functions
        async function handleAddTransaction(e) {
            e.preventDefault();
            
            const transactionData = {
                id: Date.now().toString(),
                title: document.getElementById('transactionTitle').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                type: document.querySelector('[data-field="transactionType"] span').textContent,
                category: document.querySelector('[data-field="transactionCategory"] span').textContent,
                date: document.getElementById('transactionDate').value,
                status: document.querySelector('[data-field="transactionStatus"] span').textContent,
                reference: document.getElementById('transactionReference').value,
                client: document.getElementById('transactionClient').value,
                notes: document.getElementById('transactionNotes').value,
                createdAt: new Date().toISOString()
            };
            
            try {
                await set(ref(database, `transactions/${transactionData.id}`), transactionData);
                document.getElementById('addTransactionModal').style.display = 'none';
                resetAddTransactionForm();
                loadFinance();
                loadDashboard(); // Update dashboard stats
                showSnackbar('Transaction added successfully!');
                addNotificationToPanel(`New ${transactionData.type.toLowerCase()}: ₹${transactionData.amount.toLocaleString()}`, 'task');
            } catch (error) {
                console.error('Error adding transaction:', error);
                showSnackbar('Error adding transaction. Please try again.');
            }
        }

        async function deleteTransaction(transactionId) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                try {
                    await remove(ref(database, `transactions/${transactionId}`));
                    loadFinance();
                    loadDashboard();
                    showSnackbar('Transaction deleted successfully');
                } catch (error) {
                    console.error('Error deleting transaction:', error);
                    showSnackbar('Error deleting transaction');
                }
            }
        }

        // Schedule Reminder Notification
        function scheduleReminderNotification(reminderData) {
            const reminderDate = new Date(reminderData.dateTime);
            const now = new Date();
            const timeDiff = reminderDate.getTime() - now.getTime();
            
            if (timeDiff > 0) {
                setTimeout(() => {
                    const message = `Reminder: ${reminderData.title}`;
                    addNotificationToPanel(message, 'reminder');
                    
                    // Show push notification if permission granted
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('Reminder', {
                            body: message,
                            icon: '/favicon.ico'
                        });
                    }
                }, timeDiff);
            }
        }

        // Reset Form Functions
        function resetAddTaskForm() {
            document.getElementById('addTaskForm').reset();
            document.querySelector('[data-field="taskPriority"] span').textContent = 'Select Priority';
            document.querySelector('[data-field="taskCategory"] span').textContent = 'Select Category';
        }

        function resetAddReminderForm() {
            document.getElementById('addReminderForm').reset();
            document.querySelector('[data-field="reminderType"] span').textContent = 'Select Type';
            document.querySelector('[data-field="reminderRepeat"] span').textContent = 'Repeat';
        }

        function resetAddTransactionForm() {
            document.getElementById('addTransactionForm').reset();
            document.querySelector('[data-field="transactionType"] span').textContent = 'Select Type';
            document.querySelector('[data-field="transactionCategory"] span').textContent = 'Select Category';
            document.querySelector('[data-field="transactionStatus"] span').textContent = 'Status';
        }

        // Filter Functions
        function setupFilterListeners() {
            // Task filters
            document.querySelectorAll('.task-filter').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.task-filter').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const filter = e.target.dataset.filter;
                    // Re-render tasks with filter (would need to store current tasks)
                    loadTasks().then(() => {
                        // Apply filter after loading
                        const tasksRef = ref(database, 'tasks');
                        get(tasksRef).then(snapshot => {
                            if (snapshot.exists()) {
                                const tasks = Object.entries(snapshot.val()).map(([id, task]) => ({id, ...task}));
                                renderTasks(tasks, filter);
                            }
                        });
                    });
                });
            });

            // Reminder filters
            document.querySelectorAll('.reminder-filter').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.reminder-filter').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const filter = e.target.dataset.filter;
                    const remindersRef = ref(database, 'reminders');
                    get(remindersRef).then(snapshot => {
                        if (snapshot.exists()) {
                            const reminders = Object.entries(snapshot.val()).map(([id, reminder]) => ({id, ...reminder}));
                            renderReminders(reminders, filter);
                        }
                    });
                });
            });

            // Transaction filters
            document.querySelectorAll('.transaction-filter').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.transaction-filter').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const filter = e.target.dataset.filter;
                    const transactionsRef = ref(database, 'transactions');
                    get(transactionsRef).then(snapshot => {
                        if (snapshot.exists()) {
                            const transactions = Object.entries(snapshot.val()).map(([id, transaction]) => ({id, ...transaction}));
                            renderTransactions(transactions, filter);
                        }
                    });
                });
            });
        }

        // Enhanced Quick Add Handler
        function enhancedHandleQuickAdd(action) {
            console.log('🚀 Quick add action:', action);
            try {
                switch (action) {
                    case 'task':
                        const taskModal = document.getElementById('addTaskModal');
                        if (taskModal) {
                            taskModal.style.display = 'flex';
                            console.log('✅ Task modal opened');
                        } else {
                            console.error('❌ Task modal not found');
                            showSnackbar('❌ Task modal not available');
                        }
                        break;
                    case 'reminder':
                        const reminderModal = document.getElementById('addReminderModal');
                        if (reminderModal) {
                            reminderModal.style.display = 'flex';
                            console.log('✅ Reminder modal opened');
                        } else {
                            console.error('❌ Reminder modal not found');
                            showSnackbar('❌ Reminder modal not available');
                        }
                        break;
                    case 'transaction':
                        const transactionModal = document.getElementById('addTransactionModal');
                        if (transactionModal) {
                            transactionModal.style.display = 'flex';
                            console.log('✅ Transaction modal opened');
                        } else {
                            console.error('❌ Transaction modal not found');
                            showSnackbar('❌ Transaction modal not available');
                        }
                        break;
                    default:
                        console.log('🔄 Falling back to original handleQuickAdd');
                        handleQuickAdd(action); // Fall back to original function
                }
            } catch (error) {
                console.error('❌ Error in enhancedHandleQuickAdd:', error);
                showSnackbar('❌ Error opening modal');
            }
        }

        // Make functions globally available
        window.toggleTaskStatus = toggleTaskStatus;
        window.deleteTask = deleteTask;
        window.editTask = (id) => console.log('Edit task:', id); // Placeholder
        window.markReminderComplete = markReminderComplete;
        window.deleteReminder = deleteReminder;
        window.editReminder = (id) => console.log('Edit reminder:', id); // Placeholder
        window.deleteTransaction = deleteTransaction;
        window.editTransaction = (id) => console.log('Edit transaction:', id); // Placeholder

        // Setup New Feature Event Listeners
        function setupNewFeatureListeners() {
            // Task Modal Event Listeners
            const addTaskBtn = document.getElementById('addTaskBtn');
            const addTaskModal = document.getElementById('addTaskModal');
            const cancelAddTask = document.getElementById('cancelAddTask');
            const cancelAddTask2 = document.getElementById('cancelAddTask2');
            const addTaskForm = document.getElementById('addTaskForm');

            if (addTaskBtn) {
                addTaskBtn.addEventListener('click', () => {
                    addTaskModal.style.display = 'flex';
                });
            }

            if (cancelAddTask) {
                cancelAddTask.addEventListener('click', () => {
                    addTaskModal.style.display = 'none';
                    resetAddTaskForm();
                });
            }

            if (cancelAddTask2) {
                cancelAddTask2.addEventListener('click', () => {
                    addTaskModal.style.display = 'none';
                    resetAddTaskForm();
                });
            }

            if (addTaskForm) {
                addTaskForm.addEventListener('submit', handleAddTask);
            }

            // Reminder Modal Event Listeners
            const addReminderBtn = document.getElementById('addReminderBtn');
            const addReminderModal = document.getElementById('addReminderModal');
            const cancelAddReminder = document.getElementById('cancelAddReminder');
            const cancelAddReminder2 = document.getElementById('cancelAddReminder2');
            const addReminderForm = document.getElementById('addReminderForm');

            if (addReminderBtn) {
                addReminderBtn.addEventListener('click', () => {
                    addReminderModal.style.display = 'flex';
                });
            }

            if (cancelAddReminder) {
                cancelAddReminder.addEventListener('click', () => {
                    addReminderModal.style.display = 'none';
                    resetAddReminderForm();
                });
            }

            if (cancelAddReminder2) {
                cancelAddReminder2.addEventListener('click', () => {
                    addReminderModal.style.display = 'none';
                    resetAddReminderForm();
                });
            }

            if (addReminderForm) {
                addReminderForm.addEventListener('submit', handleAddReminder);
            }

            // Transaction Modal Event Listeners
            const addTransactionBtn = document.getElementById('addTransactionBtn');
            const addTransactionModal = document.getElementById('addTransactionModal');
            const cancelAddTransaction = document.getElementById('cancelAddTransaction');
            const cancelAddTransaction2 = document.getElementById('cancelAddTransaction2');
            const addTransactionForm = document.getElementById('addTransactionForm');

            if (addTransactionBtn) {
                addTransactionBtn.addEventListener('click', () => {
                    addTransactionModal.style.display = 'flex';
                });
            }

            if (cancelAddTransaction) {
                cancelAddTransaction.addEventListener('click', () => {
                    addTransactionModal.style.display = 'none';
                    resetAddTransactionForm();
                });
            }

            if (cancelAddTransaction2) {
                cancelAddTransaction2.addEventListener('click', () => {
                    addTransactionModal.style.display = 'none';
                    resetAddTransactionForm();
                });
            }

            if (addTransactionForm) {
                addTransactionForm.addEventListener('submit', handleAddTransaction);
            }

            // Finance Quick Action Buttons
            const addIncomeBtn = document.getElementById('addIncomeBtn');
            if (addIncomeBtn) {
                addIncomeBtn.addEventListener('click', () => {
                    addTransactionModal.style.display = 'flex';
                    setTimeout(() => {
                        const typeButton = document.querySelector('[data-field="transactionType"] span');
                        if (typeButton) typeButton.textContent = 'Income';
                    }, 100);
                });
            }

            const addExpenseBtn = document.getElementById('addExpenseBtn');
            if (addExpenseBtn) {
                addExpenseBtn.addEventListener('click', () => {
                    addTransactionModal.style.display = 'flex';
                    setTimeout(() => {
                        const typeButton = document.querySelector('[data-field="transactionType"] span');
                        if (typeButton) typeButton.textContent = 'Expense';
                    }, 100);
                });
            }

            const addPaymentReminderBtn = document.getElementById('addPaymentReminderBtn');
            if (addPaymentReminderBtn) {
                addPaymentReminderBtn.addEventListener('click', () => {
                    addReminderModal.style.display = 'flex';
                    setTimeout(() => {
                        const typeButton = document.querySelector('[data-field="reminderType"] span');
                        if (typeButton) typeButton.textContent = 'Payment';
                    }, 100);
                });
            }

            const generateReportBtn = document.getElementById('generateReportBtn');
            if (generateReportBtn) {
                generateReportBtn.addEventListener('click', () => {
                    showSnackbar('Report generation feature coming soon!');
                });
            }

            // Analytics Refresh Button
            const refreshAnalyticsBtn = document.getElementById('refreshAnalyticsBtn');
            if (refreshAnalyticsBtn) {
                refreshAnalyticsBtn.addEventListener('click', () => {
                    loadAnalytics();
                    showSnackbar('Analytics data refreshed!');
                });
            }

            // Close modals when clicking overlay
            if (addTaskModal) {
                addTaskModal.addEventListener('click', (e) => {
                    if (e.target === addTaskModal) {
                        addTaskModal.style.display = 'none';
                        resetAddTaskForm();
                    }
                });
            }

            if (addReminderModal) {
                addReminderModal.addEventListener('click', (e) => {
                    if (e.target === addReminderModal) {
                        addReminderModal.style.display = 'none';
                        resetAddReminderForm();
                    }
                });
            }

            if (addTransactionModal) {
                addTransactionModal.addEventListener('click', (e) => {
                    if (e.target === addTransactionModal) {
                        addTransactionModal.style.display = 'none';
                        resetAddTransactionForm();
                    }
                });
            }

            // Setup filter listeners
            setupFilterListeners();
        }

        // Enhanced initialization to load all new features
        setTimeout(() => {
            setupNewFeatureListeners();
            loadTasks();
            loadReminders();
            loadFinance();
            loadAnalytics();
        }, 1000);

        // Setup New Feature Event Listeners
        function setupNewFeatureListeners() {
            // Task Modal Event Listeners
            const addTaskBtn = document.getElementById('addTaskBtn');
            const addTaskModal = document.getElementById('addTaskModal');
            const cancelAddTask = document.getElementById('cancelAddTask');
            const cancelAddTask2 = document.getElementById('cancelAddTask2');
            const addTaskForm = document.getElementById('addTaskForm');

            if (addTaskBtn) {
                addTaskBtn.addEventListener('click', () => {
                    addTaskModal.style.display = 'flex';
                });
            }

            if (cancelAddTask) {
                cancelAddTask.addEventListener('click', () => {
                    addTaskModal.style.display = 'none';
                    resetAddTaskForm();
                });
            }

            if (cancelAddTask2) {
                cancelAddTask2.addEventListener('click', () => {
                    addTaskModal.style.display = 'none';
                    resetAddTaskForm();
                });
            }

            if (addTaskForm) {
                addTaskForm.addEventListener('submit', handleAddTask);
            }

            // Reminder Modal Event Listeners
            const addReminderBtn = document.getElementById('addReminderBtn');
            const addReminderModal = document.getElementById('addReminderModal');
            const cancelAddReminder = document.getElementById('cancelAddReminder');
            const cancelAddReminder2 = document.getElementById('cancelAddReminder2');
            const addReminderForm = document.getElementById('addReminderForm');

            if (addReminderBtn) {
                addReminderBtn.addEventListener('click', () => {
                    addReminderModal.style.display = 'flex';
                });
            }

            if (cancelAddReminder) {
                cancelAddReminder.addEventListener('click', () => {
                    addReminderModal.style.display = 'none';
                    resetAddReminderForm();
                });
            }

            if (cancelAddReminder2) {
                cancelAddReminder2.addEventListener('click', () => {
                    addReminderModal.style.display = 'none';
                    resetAddReminderForm();
                });
            }

            if (addReminderForm) {
                addReminderForm.addEventListener('submit', handleAddReminder);
            }

            // Transaction Modal Event Listeners
            const addTransactionBtn = document.getElementById('addTransactionBtn');
            const addTransactionModal = document.getElementById('addTransactionModal');
            const cancelAddTransaction = document.getElementById('cancelAddTransaction');
            const cancelAddTransaction2 = document.getElementById('cancelAddTransaction2');
            const addTransactionForm = document.getElementById('addTransactionForm');

            if (addTransactionBtn) {
                addTransactionBtn.addEventListener('click', () => {
                    addTransactionModal.style.display = 'flex';
                });
            }

            if (cancelAddTransaction) {
                cancelAddTransaction.addEventListener('click', () => {
                    addTransactionModal.style.display = 'none';
                    resetAddTransactionForm();
                });
            }

            if (cancelAddTransaction2) {
                cancelAddTransaction2.addEventListener('click', () => {
                    addTransactionModal.style.display = 'none';
                    resetAddTransactionForm();
                });
            }

            if (addTransactionForm) {
                addTransactionForm.addEventListener('submit', handleAddTransaction);
            }

            // Finance Quick Action Buttons
            const addIncomeBtn = document.getElementById('addIncomeBtn');
            if (addIncomeBtn) {
                addIncomeBtn.addEventListener('click', () => {
                    addTransactionModal.style.display = 'flex';
                    setTimeout(() => {
                        const typeButton = document.querySelector('[data-field="transactionType"] span');
                        if (typeButton) typeButton.textContent = 'Income';
                    }, 100);
                });
            }

            const addExpenseBtn = document.getElementById('addExpenseBtn');
            if (addExpenseBtn) {
                addExpenseBtn.addEventListener('click', () => {
                    addTransactionModal.style.display = 'flex';
                    setTimeout(() => {
                        const typeButton = document.querySelector('[data-field="transactionType"] span');
                        if (typeButton) typeButton.textContent = 'Expense';
                    }, 100);
                });
            }

            const addPaymentReminderBtn = document.getElementById('addPaymentReminderBtn');
            if (addPaymentReminderBtn) {
                addPaymentReminderBtn.addEventListener('click', () => {
                    addReminderModal.style.display = 'flex';
                    setTimeout(() => {
                        const typeButton = document.querySelector('[data-field="reminderType"] span');
                        if (typeButton) typeButton.textContent = 'Payment';
                    }, 100);
                });
            }

            const generateReportBtn = document.getElementById('generateReportBtn');
            if (generateReportBtn) {
                generateReportBtn.addEventListener('click', () => {
                    showSnackbar('Report generation feature coming soon!');
                });
            }

            // Analytics Refresh Button
            const refreshAnalyticsBtn = document.getElementById('refreshAnalyticsBtn');
            if (refreshAnalyticsBtn) {
                refreshAnalyticsBtn.addEventListener('click', () => {
                    loadAnalytics();
                    showSnackbar('Analytics data refreshed!');
                });
            }

            // Close modals when clicking overlay
            if (addTaskModal) {
                addTaskModal.addEventListener('click', (e) => {
                    if (e.target === addTaskModal) {
                        addTaskModal.style.display = 'none';
                        resetAddTaskForm();
                    }
                });
            }

            if (addReminderModal) {
                addReminderModal.addEventListener('click', (e) => {
                    if (e.target === addReminderModal) {
                        addReminderModal.style.display = 'none';
                        resetAddReminderForm();
                    }
                });
            }

            if (addTransactionModal) {
                addTransactionModal.addEventListener('click', (e) => {
                    if (e.target === addTransactionModal) {
                        addTransactionModal.style.display = 'none';
                        resetAddTransactionForm();
                    }
                });
            }

            // Setup filter listeners
            setupFilterListeners();
        }

        // Initialize new features after DOM is ready
        setTimeout(() => {
            setupNewFeatureListeners();
        }, 500);

        // Check reminders every 5 minutes
        setInterval(checkReminders, 5 * 60 * 1000);

        // Add comprehensive diagnostics and fixes
        function runDiagnostics() {
            console.log('🔍 Running Business Manager Diagnostics...');
            
            // Test Firebase connection
            if (database) {
                console.log('✅ Firebase database connected');
            } else {
                console.error('❌ Firebase database not connected');
            }
            
            // Test DOM elements
            const elements = [
                'addTaskModal', 'addReminderModal', 'addTransactionModal',
                'tasksContainer', 'remindersContainer', 'financeContainer',
                'fab', 'quickAddMenu'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    console.log(`✅ Element found: ${id}`);
                } else {
                    console.error(`❌ Element missing: ${id}`);
                }
            });
            
            // Test functions
            const functions = ['handleAddTask', 'handleAddReminder', 'handleAddTransaction', 'loadTasks'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    console.log(`✅ Function available: ${funcName}`);
                } else {
                    console.error(`❌ Function missing: ${funcName}`);
                }
            });
            
            console.log('🔍 Diagnostics complete!');
        }

        // Fix common issues
        function fixCommonIssues() {
            console.log('🔧 Applying fixes...');
            
            // Ensure FAB works
            const fab = document.getElementById('fab');
            if (fab) {
                fab.onclick = function() {
                    console.log('🎯 FAB clicked');
                    const quickAddMenu = document.getElementById('quickAddMenu');
                    if (quickAddMenu) {
                        quickAddMenu.classList.toggle('show');
                    }
                };
            }
            
            // Ensure quick add items work
            document.querySelectorAll('.quick-add-item').forEach(item => {
                item.onclick = function() {
                    const action = this.dataset.action;
                    console.log('🎯 Quick add item clicked:', action);
                    enhancedHandleQuickAdd(action);
                    document.getElementById('quickAddMenu').classList.remove('show');
                };
            });
            
            // Add manual modal openers for testing
            window.testOpenTaskModal = function() {
                console.log('🧪 Testing task modal...');
                const modal = document.getElementById('addTaskModal');
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('✅ Task modal opened manually');
                } else {
                    console.error('❌ Task modal not found');
                }
            };
            
            window.testOpenReminderModal = function() {
                console.log('🧪 Testing reminder modal...');
                const modal = document.getElementById('addReminderModal');
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('✅ Reminder modal opened manually');
                } else {
                    console.error('❌ Reminder modal not found');
                }
            };
            
            window.testOpenTransactionModal = function() {
                console.log('🧪 Testing transaction modal...');
                const modal = document.getElementById('addTransactionModal');
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('✅ Transaction modal opened manually');
                } else {
                    console.error('❌ Transaction modal not found');
                }
            };
            
            // Add test data function
            window.addTestData = async function() {
                console.log('🧪 Adding test data...');
                try {
                    // Add test task
                    const testTask = {
                        id: 'test-task-' + Date.now(),
                        title: 'Test Task',
                        description: 'This is a test task',
                        priority: 'High',
                        category: 'Work',
                        dueDate: new Date().toISOString(),
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    };
                    
                    await set(ref(database, `tasks/${testTask.id}`), testTask);
                    console.log('✅ Test task added');
                    
                    // Add test reminder
                    const testReminder = {
                        id: 'test-reminder-' + Date.now(),
                        title: 'Test Reminder',
                        notes: 'This is a test reminder',
                        type: 'Meeting',
                        dateTime: new Date(Date.now() + 60000).toISOString(),
                        repeat: 'None',
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    };
                    
                    await set(ref(database, `reminders/${testReminder.id}`), testReminder);
                    console.log('✅ Test reminder added');
                    
                    // Add test transaction
                    const testTransaction = {
                        id: 'test-transaction-' + Date.now(),
                        title: 'Test Transaction',
                        amount: 1000,
                        type: 'Income',
                        category: 'Client Payment',
                        date: new Date().toISOString().split('T')[0],
                        status: 'Completed',
                        reference: 'TEST001',
                        client: 'Test Client',
                        notes: 'This is a test transaction',
                        createdAt: new Date().toISOString()
                    };
                    
                    await set(ref(database, `transactions/${testTransaction.id}`), testTransaction);
                    console.log('✅ Test transaction added');
                    
                    // Reload all data
                    await loadTasks();
                    await loadReminders();
                    await loadFinance();
                    
                    showSnackbar('🧪 Test data added successfully!');
                    
                } catch (error) {
                    console.error('❌ Error adding test data:', error);
                    showSnackbar('❌ Error adding test data');
                }
            };
            
            console.log('🔧 Fixes applied!');
            console.log('💡 Try these commands in console:');
            console.log('   testOpenTaskModal() - Open task modal');
            console.log('   testOpenReminderModal() - Open reminder modal');
            console.log('   testOpenTransactionModal() - Open transaction modal');
            console.log('   addTestData() - Add test data to Firebase');
        }

        // Run diagnostics and fixes after everything loads
        setTimeout(() => {
            runDiagnostics();
            fixCommonIssues();
            addGlobalTestFunctions();
            showSnackbar('🎉 Business Manager is ready! Check console for diagnostics.');
        }, 2000);

        // Add global test functions for manual testing
        function addGlobalTestFunctions() {
            // Make modal openers globally available
            window.openTaskModal = () => openModalDirect('addTaskModal');
            window.openReminderModal = () => openModalDirect('addReminderModal');
            window.openTransactionModal = () => openModalDirect('addTransactionModal');
            
            // Make quick add globally available
            window.quickAddTask = () => handleQuickAddDirect('task');
            window.quickAddReminder = () => handleQuickAddDirect('reminder');
            window.quickAddTransaction = () => handleQuickAddDirect('transaction');
            
            // Toggle FAB menu
            window.toggleFAB = function() {
                const menu = document.getElementById('quickAddMenu');
                if (menu) {
                    menu.classList.toggle('show');
                    console.log('✅ FAB menu toggled manually');
                } else {
                    console.error('❌ FAB menu not found');
                }
            };
            
            // Test all buttons
            window.testAllButtons = function() {
                console.log('🧪 Testing all buttons...');
                
                const buttons = [
                    'fab', 'addTaskBtn', 'addReminderBtn', 'addTransactionBtn', 'menuToggle'
                ];
                
                buttons.forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        console.log(`✅ Button found: ${id}`);
                        // Test click
                        try {
                            btn.click();
                            console.log(`✅ Button clickable: ${id}`);
                        } catch (e) {
                            console.error(`❌ Button click error ${id}:`, e);
                        }
                    } else {
                        console.error(`❌ Button not found: ${id}`);
                    }
                });
            };
            
            console.log('🔧 Global test functions added:');
            console.log('   openTaskModal() - Open task modal');
            console.log('   openReminderModal() - Open reminder modal');
            console.log('   openTransactionModal() - Open transaction modal');
            console.log('   quickAddTask() - Quick add task');
            console.log('   quickAddReminder() - Quick add reminder');
            console.log('   quickAddTransaction() - Quick add transaction');
            console.log('   toggleFAB() - Toggle FAB menu');
            console.log('   testAllButtons() - Test all button functionality');
        }

    </script>
</body>
</html>

